

bpm_spirit_exile_character = {
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/exile_character"

	potential = {
		is_in_exile_pool = no
		is_in_void = no
		exists = owner
		# Cannot exile pure commanders, we have the retire interaction for that
		OR = {
			has_role = politician
			has_role = agitator
		}
		owner = { is_player = yes }
		is_ruler = no
		is_heir = no
		NOT = { has_variable = bpm_untouchable_char }
	}

	show_requirements = yes

	possible = {
		OR = {
			has_role = agitator
			interest_group = {
				is_marginal = no
			}
		}
		owner = { bpm_spirit_can_spend_huge = yes }
	}

	effect = {
		this.interest_group = {
			save_scope_as = relevant_ig
		}
		this = {
			save_scope_as = exile_scope
		}
		owner = {
			save_scope_as = exiling_country_scope
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = { has_role = agitator }
				}
				add_character_role = agitator
			}
			if = {
				limit = {
					has_role = general
				}
				remove_character_role = general
			}
			if = {
				limit = {
					has_role = admiral
				}
				remove_character_role = admiral
			}
			if = {
				limit = {
					has_role = politician
				}
				set_as_interest_group_leader = no
				remove_character_role = politician
			}
		}
		owner = { bpm_spirit_spend_huge = yes }
		custom_tooltip = {
			text = bpm_spirit_exile_tt
			exile_character_with_martyrdom = yes
		}
	}

	show_confirmation_box = yes

	ai_chance = {
		value = -50
	}
}

bpm_spirit_make_character_popular = {
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/character_invite"

	potential = {
		is_in_exile_pool = no
		is_in_void = no
		exists = owner
		owner = { is_player = yes }
		NOT = { has_variable = bpm_untouchable_char }
	}

	show_requirements = yes

	possible = {
		OR = {
			has_role = agitator
			interest_group = {
				is_marginal = no
			}
		}
		NOT = { has_modifier = bpm_spirit_lucky_popularity_huge }
		trigger_if = {
			limit = { 
				NAND = { 
					has_modifier = bpm_spirit_lucky_popularity 
					has_modifier = bpm_spirit_lucky_popularity_large
				} 
			}
			owner = { bpm_spirit_can_spend_small = yes }
		} trigger_else_if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_lucky_popularity_large 
				} 
			}
			owner = { bpm_spirit_can_spend_large = yes }
		} trigger_else = {
			owner = { bpm_spirit_can_spend_huge = yes }
		}
	}

	effect = {
		if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_lucky_popularity 
					has_modifier = bpm_spirit_lucky_popularity_large
				} 
			}
			add_modifier = {
				name = bpm_spirit_lucky_popularity
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_small = yes }
		} else_if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_lucky_popularity_large 
				} 
			}
			remove_modifier = bpm_spirit_lucky_popularity
			add_modifier = {
				name = bpm_spirit_lucky_popularity_large
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_large = yes }
		} else = {
			remove_modifier = bpm_spirit_lucky_popularity_large
			add_modifier = {
				name = bpm_spirit_lucky_popularity_huge
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_huge = yes }
		}
	}

	show_confirmation_box = yes

	ai_chance = {
		value = -50
	}
}

bpm_spirit_make_character_unpopular = {
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/character_invite"

	potential = {
		is_in_exile_pool = no
		is_in_void = no
		exists = owner
		owner = { is_player = yes }
		NOT = { has_variable = bpm_untouchable_char }
	}

	show_requirements = yes

	possible = {
		OR = {
			has_role = agitator
			interest_group = {
				is_marginal = no
			}
		}
		NOT = { has_modifier = bpm_spirit_unlucky_disgrace_huge }
		trigger_if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_unlucky_disgrace 
					has_modifier = bpm_spirit_unlucky_disgrace_large
				} 
			}
			owner = { bpm_spirit_can_spend_small = yes }
		} trigger_else_if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_unlucky_disgrace_large 
				} 
			}
			owner = { bpm_spirit_can_spend_large = yes }
		} trigger_else = {
			owner = { bpm_spirit_can_spend_huge = yes }
		}
	}

	effect = {
		if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_unlucky_disgrace 
					has_modifier = bpm_spirit_unlucky_disgrace_large
				} 
			}
			add_modifier = {
				name = bpm_spirit_unlucky_disgrace
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_small = yes }
		} else_if = {
			limit = { 
				NOT = { 
					has_modifier = bpm_spirit_unlucky_disgrace_large 
				} 
			}
			remove_modifier = bpm_spirit_unlucky_disgrace
			add_modifier = {
				name = bpm_spirit_unlucky_disgrace_large
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_large = yes }
		} else = {
			remove_modifier = bpm_spirit_unlucky_disgrace_large
			add_modifier = {
				name = bpm_spirit_unlucky_disgrace_huge
				years = 5
				is_decaying = yes
			}
			owner = { bpm_spirit_spend_huge = yes }
		}
	}

	show_confirmation_box = yes

	ai_chance = {
		value = -50
	}
}

bpm_spirit_expel_agitator_faction = {
	clicksound = "event:/SFX/DLC/1.3_ip1/UI/character_invite"

	potential = {
		is_in_exile_pool = no
		is_in_void = no
		exists = owner
		has_role = agitator
		owner = { is_player = yes }
		character_supports_political_movement = yes
	}

	show_requirements = yes

	possible = {
		NOT = { has_modifier = bpm_spirit_agitator_faction_expelled_character }
		owner = { bpm_spirit_can_spend_huge = yes }
	}

	effect = {
		add_modifier = {
			name = bpm_spirit_agitator_faction_expelled_character
			years = 5
			is_decaying = yes
		}
		political_movement = {
			add_modifier = {
				name = bpm_spirit_agitator_faction_expelled_movement
				years = 5
				is_decaying = yes
			}
		}
		owner = { bpm_spirit_spend_huge = yes }
	}

	show_confirmation_box = yes

	ai_chance = {
		value = -50
	}
}
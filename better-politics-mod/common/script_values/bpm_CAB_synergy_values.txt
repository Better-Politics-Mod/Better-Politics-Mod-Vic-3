# bpm_synergy_of_charset = {
#     # we have a variable list called bpm_synergy_calculation_charset
#     # we go through each law and check the highest opinion and lowest opinion
#     # we then calculate the difference between the highest and lowest opinion
#     value = 0
#     add = bpm_synergy_of_charset_raw
#     divide = bpm_synergy_of_charset_divisor
# }

bpm_cab_synergy_value_parl_base = {
    value = 200
    multiply = {
        value = 0
        every_interest_group = {
            limit = {
                OR = {
                    AND = {
                        is_in_government = yes
                        ig_approval >= unhappy
                    }
                    AND = {
                        is_in_government = no
                        ig_approval >= happy
                    }
                }
            }
            add = ig_clout
        }
    }
}

bpm_cab_sybergy_value_parl_base_gov = {
    value = 200
    multiply = {
        value = 0
        every_interest_group = {
            limit = {
                is_in_government = yes
                ig_approval >= unhappy
            }
            add = ig_clout
        }
    }
}

bpm_cab_sybergy_value_parl_base_gov_bloc = {
    value = 1
    multiply = {
        value = 0
        every_interest_group = {
            limit = {
                is_in_government = yes
                ig_approval >= unhappy
            }
            add = ig_clout
        }
    }
}

bpm_cab_synergy_value_parl_base_opposition = {
    value = 200
    multiply = {
        value = 0
        every_interest_group = {
            limit = {
                is_in_government = no
                ig_approval >= happy
            }
            add = ig_clout
        }
    }
}

bpm_cab_synergy_value_parl_base_opposition_bloc = {
    value = 1
    multiply = {
        value = 0
        every_interest_group = {
            limit = {
                is_in_government = no
                ig_approval >= happy
            }
            add = ig_clout
        }
    }
}

bpm_cab_synergy_value_stateexh = {
    if = {
        limit = {
            has_variable = bpm_auth_state_exhaustion
        }
        value = var:bpm_auth_state_exhaustion
        multiply = bpm_cab_synergy_value_stateexh_mult
    }
}

bpm_cab_synergy_value_cab_dis = {
    value = bpm_cab_synergy_value_cab_dis_mult
    multiply = var:bpm_cab_synergy
}

bpm_cab_synergy_value_stateexh_mult = {
    if = {
        limit = {
            bpm_country_has_parliamentary_electoral_system = yes
        }
        value = 1
        divide = 50
    }
    else_if = {
        limit = {
            bpm_country_has_executive_electoral_system = yes
        }
        value = 1
        divide = 20
    }
    else_if = {
        limit = {
            bpm_country_has_executive_dictatorial_system = yes
        }
        value = 1
        divide = 10
    }
    else_if = {
        limit = {
            bpm_country_has_parliamentary_oligarchic_system = yes
        }
        value = 1
        divide = 20
    }
}

bpm_cab_synergy_value_cab_dis_mult = {
    if = {
        limit = {
            bpm_country_has_parliamentary_electoral_system = yes
        }
        value = 60
    }
    else_if = {
        limit = {
            bpm_country_has_executive_electoral_system = yes
        }
        add = 40
    }
    else_if = {
        limit = {
            bpm_country_has_executive_dictatorial_system = yes
        }
        add = 40
    }
    else_if = {
        limit = {
            bpm_country_has_parliamentary_oligarchic_system = yes
        }
        add = 100
    }
}

bpm_cab_synergy_value_hoshog_dis_mult = {
    if = {
        limit = {
            bpm_country_has_parliamentary_electoral_system = yes
        }
        value = 20
    }
    else_if = {
        limit = {
            bpm_country_has_executive_electoral_system = yes
        }
        add = 0
    }
    else_if = {
        limit = {
            bpm_country_has_executive_dictatorial_system = yes
        }
        add = 0
    }
    else_if = {
        limit = {
            bpm_country_has_parliamentary_oligarchic_system = yes
        }
        add = 0
    }
}

bpm_cab_synergy_value_hoshog_dis = {
    if = {
        limit = {
            has_variable = bpm_cab_hoshog_synergy
        }
        add = {
            desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
            value = {
                value = bpm_cab_synergy_value_hoshog_dis_mult
                multiply = var:bpm_cab_hoshog_synergy
            }
        }
    }
}


bpm_cab_synergy_value_parl = {
    value = 0
    add = {
        desc = "BPM_CABINET_SYNERGY_FROM_PARLIAMENTARY_APPROVAL_GOV"
        value = bpm_cab_sybergy_value_parl_base_gov
    }
    add = {
        desc = "BPM_CABINET_SYNERGY_FROM_PARLIAMENTARY_APPROVAL_OPPOSITION"
        value = bpm_cab_synergy_value_parl_base_opposition
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_IDEOLOGY"
        value = bpm_cab_synergy_value_cab_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
        value = bpm_cab_synergy_value_hoshog_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_STATE_EXHAUSTION"
        value = bpm_cab_synergy_value_stateexh
    }
}

bpm_cab_synergy_value_pres = {
    value = 0
    add = {
        desc = "BPM_CABINET_SYNERGY_FROM_PRESIDENTIAL_BASE"
        value = 120
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_IDEOLOGY"
        value = bpm_cab_synergy_value_cab_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
        value = bpm_cab_synergy_value_hoshog_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_STATE_EXHAUSTION"
        value = bpm_cab_synergy_value_stateexh
    }
}

bpm_cab_synergy_value_autocracy = {
    value = 0
    add = {
        desc = "BPM_CABINET_SYNERGY_FROM_AUTOCRATIC_BASE"
        value = 200
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_IDEOLOGY"
        value = bpm_cab_synergy_value_cab_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
        value = bpm_cab_synergy_value_hoshog_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_STATE_EXHAUSTION"
        value = bpm_cab_synergy_value_stateexh
    }
}

bpm_cab_synergy_value_oligarchy = {
    value = 0
    add = {
        desc = "BPM_CABINET_SYNERGY_FROM_OLIGARCHIC_BASE"
        value = 200
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_IDEOLOGY"
        value = bpm_cab_synergy_value_cab_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
        value = bpm_cab_synergy_value_hoshog_dis
    }
    subtract = {
        desc = "BPM_CABINET_SYNERGY_FROM_STATE_EXHAUSTION"
        value = bpm_cab_synergy_value_stateexh
    }
}

bpm_cab_synergy_value_high_abv = {
    value = 100
    subtract = bpm_cab_synergy_value
    divide = 20
}

bpm_cab_synergy_value_mid_abv = {
    value = 80
    subtract = bpm_cab_synergy_value
    divide = 20
    min = 0
}

bpm_cab_synergy_value_low_abv = {
    value = 60
    subtract = bpm_cab_synergy_value
    divide = 60
}

bpm_cab_synergy_value = {
    value = 0
    if = {
        limit = {
            bpm_country_has_parliamentary_electoral_system = yes
        }
        add = bpm_cab_synergy_value_parl
    }
    else_if = {
        limit = {
            bpm_country_has_executive_electoral_system = yes
        }
        add = bpm_cab_synergy_value_pres
    }
    else_if = {
        limit = {
            bpm_country_has_executive_dictatorial_system = yes
        }
        add = bpm_cab_synergy_value_autocracy
    }
    else_if = {
        limit = {
            bpm_country_has_parliamentary_oligarchic_system = yes
        }
        add = bpm_cab_synergy_value_oligarchy
    }

    # add = {
    #     desc = "BPM_CABINET_SYNERGY_FROM_DEFAULT"
    #     value = modifier:country_synergy_base_add
    # }


    # if = {
    #     limit = {
    #         has_variable = bpm_cab_hoshog_synergy
    #     }
    #     add = {
    #         desc = "BPM_CABINET_SYNERGY_FROM_HOS_HOG_COMPATIBILITY"
    #         value = {
    #             value = modifier:country_synergy_from_hos_hog_compatibility
    #             multiply = var:bpm_cab_hoshog_synergy
    #         }
    #     }
    # }

    # add = {
    #     desc = "BPM_CABINET_SYNERGY_FROM_IDEOLOGY"
    #     value = {
    #         value = modifier:country_synergy_from_ideological_compatibility
    #         multiply = var:bpm_cab_synergy
    #     } 
    # }

    # if = {
    #     limit = {
    #         ruler.interest_group ?= {
    #             is_in_government = yes
    #         }
    #     }
    #     add = {
    #         desc = "BPM_CABINET_SYNERGY_FROM_HOS_IN_GOVERNMENT"
    #         value = modifier:country_synergy_from_hos_in_government
    #     }
    # }

    # add = {
    #     desc = "BPM_CABINET_SYNERGY_FROM_RIGIDITY"
    #     value = {
    #         value = modifier:country_synergy_from_rigidity_add
    #         multiply = var:bpm_political_stability
    #         divide = 100
    #     }
    # }

    multiply = {
        value = 1
        add = modifier:country_synergy_mult
    }
    round = yes
    max = 100
    min = 0
} 

bpm_cab_char_synergy_value = {
    value = 0

    add = var:bpm_cab_char_synergy
}

bpm_synergy_of_charset_divisor = {
    every_law = {
        add = 1
    }
    min = 1
}

bpm_absolute_opinion_raw = {
    value = scope:highest_opinion_char.bpm_character_law_stance_as_number_abs
    subtract = scope:lowest_opinion_char.bpm_character_law_stance_as_number_abs
}

bpm_character_law_stance_as_number_abs = {
    value = bpm_character_law_stance_as_number
    add = 2
}

bpm_character_law_stance_as_number_negative = {
    value = bpm_character_law_stance_as_number
    multiply = -1
}

bpm_character_law_stance_as_number = { 
    # we are in character scope
    # we have a law saved as scope:bpm_law_to_check
    value = 0
    if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = strongly_approve
            }
        }
        add = 2
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = approve
            }
        }
        add = 1
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = disapprove
            }
        }
        add = -1
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = strongly_disapprove
            }
        }
        add = -2
    }
    else_if = {
        interest_group = {
            add = bpm_interest_group_law_stance_as_number
        }
    }
}

bpm_interest_group_law_stance_as_number = {
        if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = strongly_approve
            }
        }
        add = 2
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = approve
            }
        }
        add = 1
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = disapprove
            }
        }
        add = -1
    }
    else_if = {
        limit = {
            law_stance = {
                law = scope:bpm_law_to_check.type
                value = strongly_disapprove
            }
        }
        add = -2
    }
}
bpm_antagonism_cached = {
    value = var:bpm_cached_antagonism
}

bpm_antagonism_raw_cached = {
    value = var:bpm_cached_antagonism_raw
}

bpm_antagonism = {
    value = bpm_antagonism_raw

    divide = 12 # NUMBER OF INSTITUTIONS

    multiply = 100

    round_to = 0.1
}

# -- Cabinet Register Institutions (2) --
bpm_antagonism_raw = {
    value = 0

    # Hardcoded because we can't access characters in the void
    if = {
        limit = {
            var:bpm_minister_of_schools ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_police ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_centralization ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_colonial_affairs ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_social_security ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_workplace_safety ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_health_system ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_home_affairs ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_suffrage ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_culture ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_diplomacy ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }

    if = {
        limit = {
            var:bpm_minister_of_economy ?= {
                bpm_is_antagonistic = yes
            }
        }
        add = 1
    }
}

bpm_law_importance_value = {
    value = 1 

    if = {
        limit = {
            type = {
                is_same_law_group_as = law_type:law_serfdom
            }
            owner = { has_law = law_type:law_serfdom } 
        }
        add = 10
    }
    else_if = {
        limit = {
            type = {
                is_same_law_group_as = law_type:law_slave_trade
            }
            NOT = { owner = { has_law = law_type:law_slavery_banned } }
        }
        add = 10
    }

    if = {
        limit = {
            type = {
                is_same_law_group_as = law_type:law_monarchy
            }
        }
        add = 5
    }
    else_if = {
        limit = {
            type = {
                is_same_law_group_as = law_type:law_universal_suffrage
            }
        }
        add = 5
    }
}
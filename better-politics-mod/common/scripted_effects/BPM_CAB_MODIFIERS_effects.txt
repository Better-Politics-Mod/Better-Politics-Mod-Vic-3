# --CABGENSCRIPT--
bpm_reload_institution_modifiers = {

    # Go through the character's IG and find the appropriate modifier
    #if = {
    #    limit = {
    #        var:bpm_is_institution_schools.interest_group = {
    #            is_interest_group_type = ig_ruralk_folk
    #        }
    #    }
    #    add_modifier = {
    #        name = bpm_CAB_institution_schools_rural_folk_modifier
    #        multiplier = investment
    #   }
    #}
    
    every_interest_group = {
        remove_modifier = bpm_colonial_affairs_attraction_modifier
        remove_modifier = bpm_social_security_attraction_modifier
        remove_modifier = bpm_workplace_safety_attraction_modifier
        remove_modifier = bpm_schools_attraction_modifier
        remove_modifier = bpm_police_attraction_modifier
        remove_modifier = bpm_home_affairs_attraction_modifier
        remove_modifier = bpm_centralization_attraction_modifier
        remove_modifier = bpm_culture_attraction_modifier
        remove_modifier = bpm_health_system_attraction_modifier
        remove_modifier = bpm_suffrage_attraction_modifier
        remove_modifier = bpm_hog_attraction_modifier
        remove_modifier = bpm_number_of_cabinet_picks
        remove_modifier = bpm_expected_a_cabinet_pick
        set_variable = {
            name = bpm_number_of_cabpicks
            value = 0
        }
    }

    bpm_reload_institution_modifiers_colonial_affairs = yes
    bpm_reload_institution_modifiers_social_security = yes
    bpm_reload_institution_modifiers_workplace_safety = yes
    bpm_reload_institution_modifiers_schools = yes
    bpm_reload_institution_modifiers_police = yes
    bpm_reload_institution_modifiers_home_affairs = yes
    bpm_reload_institution_modifiers_centralization = yes
    bpm_reload_institution_modifiers_culture = yes
    bpm_reload_institution_modifiers_health_system = yes
    bpm_reload_institution_modifiers_suffrage = yes
    bpm_reload_institution_modifiers_hog = yes

    every_interest_group = {
        if = {
            limit = { 
                var:bpm_number_of_cabpicks > 0 
            }
            add_modifier = {
                name = bpm_number_of_cabinet_picks
                multiplier = var:bpm_number_of_cabpicks
            }
        }
        if = {
            limit = {
                var:bpm_number_of_cabpicks ?= 0
                is_in_government = yes
            }
            add_modifier = bpm_expected_a_cabinet_pick
        }
    }

    # trigger_event = { id = BPM_CAB_DEBUG_UTILS.2 days = 1 }
}

bpm_reload_cabinet_picks_expectation = {
    remove_modifier = bpm_government_igs_without_cabinet_pick

    if = {
        limit = {
            bpm_no_cabinet_picks_government_igs_count > 0
        }
        add_modifier = {
            name = bpm_government_igs_without_cabinet_pick
            multiplier = 5
        }
    }
}

bpm_reload_modifier_inst_singlet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_doublet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_triplet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
                is_interest_group_type = ig_$IG3$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_quartet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
                is_interest_group_type = ig_$IG3$
                is_interest_group_type = ig_$IG4$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

# -- Cabinet Register Institutions (Modifiers) --
# Please also modify BPM_CAB_interface.txt
# in custom locs. Also modify the locs in 
# BPM_cab_modifiers_l_english.yml for the UI to stay accurate.
bpm_reload_institution_modifiers_schools = {
    institution:institution_schools ?= {
        bpm_remove_institution_modifiers_schools = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_schools ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_schools
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_schools
        }
        var:bpm_is_institution_schools.interest_group = {

            bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = schools
                MOD = bpm_schools_agpops_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = anarchists
                INST = schools
                MOD = bpm_schools_anarchists_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = schools
                MOD = bpm_schools_cons_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = schools
                MOD = bpm_schools_fash_modifier
            }

            bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = schools
                MOD = bpm_schools_libs_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = schools
                MOD = bpm_schools_lefts_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = schools
                MOD = bpm_schools_commies_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = schools
                MOD = bpm_schools_military_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = schools
                MOD = bpm_schools_devout_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = landowners
                IG2 = industrialists
                INST = schools
                MOD = bpm_schools_capis_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = schools
                MOD = bpm_schools_intel_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = schools
                MOD = bpm_schools_pb_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = schools
                MOD = bpm_schools_ruries_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = schools
                MOD = bpm_schools_unions_modifier
            }

            add_modifier = {
                name = bpm_schools_attraction_modifier
                multiplier = owner.institution:institution_schools.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_colonial_affairs = {
    institution:institution_colonial_affairs ?= {
        bpm_remove_institution_modifiers_colonial_affairs = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_colonial_affairs ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_colonial_affairs
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_colonial_affairs
        }
        var:bpm_is_institution_colonial_affairs.interest_group = {
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_cons_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_fash_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_libs_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = reformist_socialists
                IG2 = radicals
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_lefts_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_military_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_devout_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = industrialists
                IG2 = intelligentsia
                IG3 = landowners
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_neutraling_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_pb_modifier
           }

            add_modifier = {
                name = bpm_colonial_affairs_attraction_modifier
                multiplier = owner.institution:institution_colonial_affairs.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_social_security = {
    institution:institution_social_security ?= {
        bpm_remove_institution_modifiers_social_security = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_social_security ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_social_security
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_social_security
        }
        var:bpm_is_institution_social_security.interest_group = {
           bpm_reload_modifier_inst_doublet = {
                IG1 = agrarian_populists
                IG2 = anarchists
                INST = social_security
                MOD = bpm_social_security_rursocs_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = conservatives
                INST = social_security
                MOD = bpm_social_security_cons_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = social_security
                MOD = bpm_social_security_liberals_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = social_security
                MOD = bpm_social_security_lefts_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = social_security
                MOD = bpm_social_security_commies_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = armed_forces
                IG2 = intelligentsia
                INST = social_security
                MOD = bpm_social_security_neutraling_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = social_security
                MOD = bpm_social_security_devout_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = industrialists
                IG2 = landowners
                INST = social_security
                MOD = bpm_social_security_capis_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = social_security
                MOD = bpm_social_security_pb_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = social_security
                MOD = bpm_social_security_ruries_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = social_security
                MOD = bpm_social_security_unions_modifier
           }

            add_modifier = {
                name = bpm_social_security_attraction_modifier
                multiplier = owner.institution:institution_social_security.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}
 
 bpm_reload_institution_modifiers_workplace_safety = {
    institution:institution_workplace_safety ?= {
        bpm_remove_institution_modifiers_workplace_safety = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_workplace_safety ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_workplace_safety
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_workplace_safety
        }
        var:bpm_is_institution_workplace_safety.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = workplace_safety
                MOD = bpm_workplace_safety_agpops_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = anarchists
                IG2 = radicals
                IG3 = reformist_socialists
                IG4 = socialists
                INST = workplace_safety
                MOD = bpm_workplace_safety_lefts_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = conservatives
                IG2 = liberals
                IG3 = market_liberals
                IG4 = national_liberals
                INST = workplace_safety
                MOD = bpm_workplace_safety_neutralidg_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = revolutionist_socialists
                INST = workplace_safety
                MOD = bpm_workplace_safety_commies_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = armed_forces
                IG2 = devout
                IG3 = intelligentsia
                IG4 = petty_bourgeoisie
                INST = workplace_safety
                MOD = bpm_workplace_safety_neutraling_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = workplace_safety
                MOD = bpm_workplace_safety_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = workplace_safety
                MOD = bpm_workplace_safety_unions_modifier
            }

            add_modifier = {
                name = bpm_workplace_safety_attraction_modifier
                multiplier = owner.institution:institution_workplace_safety.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_police = {
    institution:institution_police ?= {
        bpm_remove_institution_modifiers_police = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_police ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_police
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_police
        }
        var:bpm_is_institution_police.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = police
                MOD = bpm_police_agpops_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = police
                MOD = bpm_police_cons_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = police
                MOD = bpm_police_fash_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = police
                MOD = bpm_police_liberals_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = radicals
                IG2 = reformist_socialists
                IG3 = socialists
                INST = police
                MOD = bpm_police_lefts_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = revolutionist_socialists
                INST = police
                MOD = bpm_police_commies_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = police
                MOD = bpm_police_military_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = police
                MOD = bpm_police_devout_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = industrialists
                INST = police
                MOD = bpm_police_capis_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = police
                MOD = bpm_police_intel_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = landowners
                INST = police
                MOD = bpm_police_aris_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = police
                MOD = bpm_police_pb_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = police
                MOD = bpm_police_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = police
                MOD = bpm_police_unions_modifier
            }

            add_modifier = {
                name = bpm_police_attraction_modifier
                multiplier = owner.institution:institution_police.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_home_affairs = {
    institution:institution_home_affairs ?= {
        bpm_remove_institution_modifiers_home_affairs = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_home_affairs ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_home_affairs
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_home_affairs
        }
        var:bpm_is_institution_home_affairs.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = conservatives
                INST = home_affairs
                MOD = bpm_home_affairs_cons_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = home_affairs
                MOD = bpm_home_affairs_liberals_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = radicals
                IG2 = reformist_socialists
                IG3 = socialists
                INST = home_affairs
                MOD = bpm_home_affairs_pseudoleft_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = devout
                IG2 = rural_folk
                IG3 = trade_unions
                INST = home_affairs
                MOD = bpm_home_affairs_neutraling_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = industrialists
                IG2 = landowners
                INST = home_affairs
                MOD = bpm_home_affairs_capis_modifier
            }
            if = {
                limit = {
                    owner = { has_law = law_type:law_guaranteed_liberties }
                }
                bpm_reload_modifier_inst_singlet = {
                    IG1 = agrarian_populists
                    INST = home_affairs
                    MOD = bpm_home_affairs_agpops_modifier
                }
               bpm_reload_modifier_inst_doublet = {
                    IG1 = anarchists
                    IG2 = revolutionist_socialists
                    INST = home_affairs
                    MOD = bpm_home_affairs_leftists_modifier
                }
                bpm_reload_modifier_inst_singlet = {
                    IG1 = intelligentsia
                    INST = home_affairs
                    MOD = bpm_home_affairs_intel_modifier
                }
                bpm_reload_modifier_inst_singlet = {
                    IG1 = petty_bourgeoisie
                    INST = home_affairs
                    MOD = bpm_home_affairs_neutraling_modifier
                }
            }
            else = {
                bpm_reload_modifier_inst_singlet = {
                    IG1 = petty_bourgeoisie
                    INST = home_affairs
                    MOD = bpm_home_affairs_pb_modifier
                }
                bpm_reload_modifier_inst_singlet = {
                    IG1 = intelligentsia
                    INST = home_affairs
                    MOD = bpm_home_affairs_neutraling_modifier
                }
                bpm_reload_modifier_inst_doublet = {
                    IG1 = fascists
                    IG2 = reactionaries
                    INST = home_affairs
                    MOD = bpm_home_affairs_reacs_modifier
                }
                bpm_reload_modifier_inst_singlet = {
                    IG1 = armed_forces
                    INST = home_affairs
                    MOD = bpm_home_affairs_military_modifier
                }
            }

            add_modifier = {
                name = bpm_home_affairs_attraction_modifier
                multiplier = owner.institution:institution_home_affairs.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_centralization = {
    institution:institution_centralization ?= {
        bpm_remove_institution_modifiers_centralization = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_centralization ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_centralization
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_centralization
        }
        var:bpm_is_institution_centralization.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = centralization
                MOD = bpm_centralization_agpops_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = centralization
                MOD = bpm_centralization_cons_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = centralization
                MOD = bpm_centralization_libs_modifier
            }
            if = {
                limit = {
                    OR = {
                        is_interest_group_type = ig_fascists
                        is_interest_group_type = ig_radicals
                        is_interest_group_type = ig_reformist_socialists
                        is_interest_group_type = ig_revolutionist_socialists
                        is_interest_group_type = ig_socialists
                    }
                }
                owner.institution:institution_centralization ?= {
                    add_modifier = {
                        name = bpm_centralization_neutralidg_modifier
                        multiplier = owner.institution:institution_centralization.investment
                    }   
               }
           }
           if = {
                limit = {
                    OR = {
                        bpm_ig_is_institutional = yes
                    }
                }
                owner.institution:institution_centralization ?= {
                    add_modifier = {
                        name = bpm_centralization_neutraling_modifier
                        multiplier = owner.institution:institution_centralization.investment
                    }   
                }
            }

            add_modifier = {
                name = bpm_centralization_attraction_modifier
                multiplier = owner.institution:institution_centralization.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_culture = {
    institution:institution_culture ?= {
        bpm_remove_institution_modifiers_culture = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_culture ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_culture
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_culture
        }
        var:bpm_is_institution_culture.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = culture
                MOD = bpm_culture_fash_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = national_liberals
                INST = culture
                MOD = bpm_culture_natlibs_modifier
            }
            if = {
                limit = {
                    OR = {
                        is_interest_group_type = ig_agrarian_populists
                        is_interest_group_type = ig_conservatives
                        is_interest_group_type = ig_liberals
                        is_interest_group_type = ig_market_liberals
                        is_interest_group_type = ig_radicals
                        is_interest_group_type = ig_reactionaries
                        is_interest_group_type = ig_reformist_socialists
                        is_interest_group_type = ig_revolutionist_socialists
                        is_interest_group_type = ig_socialists
                    }
                }
                owner.institution:institution_culture ?= {
                    add_modifier = {
                        name = bpm_culture_neutralidg_modifier
                        multiplier = owner.institution:institution_culture.investment
                    }   
               }
           }
           if = {
                limit = {
                    OR = {
                        is_interest_group_type = ig_armed_forces
                        is_interest_group_type = ig_devout
                        is_interest_group_type = ig_industrialists
                        is_interest_group_type = ig_intelligentsia
                        is_interest_group_type = ig_landowners
                        is_interest_group_type = ig_petty_bourgeoisie
                        is_interest_group_type = ig_rural_folk
                        is_interest_group_type = ig_trade_unions
                    }
                }
                owner.institution:institution_culture ?= {
                    add_modifier = {
                        name = bpm_culture_neutraling_modifier
                        multiplier = owner.institution:institution_culture.investment
                    }
                }
            }

            add_modifier = {
                name = bpm_culture_attraction_modifier
                multiplier = owner.institution:institution_culture.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }

        }
    }
}

bpm_reload_institution_modifiers_health_system = {
    institution:institution_health_system ?= {
        bpm_remove_institution_modifiers_health_system = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_health_system ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_health_system
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_health_system
        }
        var:bpm_is_institution_health_system.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = health_system
                MOD = bpm_health_system_agpops_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = anarchists
                INST = health_system
                MOD = bpm_health_system_anarchists_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = health_system
                MOD = bpm_health_system_neutralidg_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = health_system
                MOD = bpm_health_system_lefts_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = health_system
                MOD = bpm_health_system_commies_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = health_system
                MOD = bpm_health_system_military_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = health_system
                MOD = bpm_health_system_devout_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = industrialists
                IG2 = landowners
                INST = health_system
                MOD = bpm_health_system_capis_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = health_system
                MOD = bpm_health_system_neutraling_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = health_system
                MOD = bpm_health_system_pb_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = health_system
                MOD = bpm_health_system_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = health_system
                MOD = bpm_health_system_unions_modifier
            }

            add_modifier = {
                name = bpm_health_system_attraction_modifier
                multiplier = owner.institution:institution_health_system.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }

        }
    }
}

bpm_reload_institution_modifiers_suffrage = {
    institution:institution_suffrage ?= {
        bpm_remove_institution_modifiers_suffrage = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_suffrage ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_suffrage
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_suffrage
        }
        var:bpm_is_institution_suffrage.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = suffrage
                MOD = bpm_suffrage_agpops_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = anarchists
                INST = suffrage
                MOD = bpm_suffrage_anarchists_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = suffrage
                MOD = bpm_suffrage_cons_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = fascists
                IG2 = liberals
                IG3 = market_liberals
                IG4 = national_liberals
                INST = suffrage
                MOD = bpm_suffrage_neutralidg_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = suffrage
                MOD = bpm_suffrage_lefts_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = suffrage
                MOD = bpm_suffrage_commies_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = armed_forces
                IG2 = devout
                IG3 = petty_bourgeoisie
                INST = suffrage
                MOD = bpm_suffrage_neutraling_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = industrialists
                INST = suffrage
                MOD = bpm_suffrage_capis_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = suffrage
                MOD = bpm_suffrage_intel_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = landowners
                INST = suffrage
                MOD = bpm_suffrage_aris_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = suffrage
                MOD = bpm_suffrage_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = suffrage
                MOD = bpm_suffrage_unions_modifier
            }

            add_modifier = {
                name = bpm_suffrage_attraction_modifier
                multiplier = owner.institution:institution_suffrage.investment
            }
            change_variable = {
                name = bpm_number_of_cabpicks
                add = 1
            }
        }
    }
}

bpm_reload_institution_modifiers_diplomacy = {
    institution:institution_diplomacy ?= {
        bpm_remove_institution_modifiers_diplomacy = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_diplomacy ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_diplomacy
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_diplomacy
        }
        var:bpm_is_institution_diplomacy.interest_group = {
        bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = diplomacy
                MOD = bpm_diplomacy_agpops_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = anarchists
                INST = diplomacy
                MOD = bpm_diplomacy_anarchists_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = conservatives
                INST = diplomacy
                MOD = bpm_diplomacy_cons_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = diplomacy
                MOD = bpm_diplomacy_fash_modifier
            }
        bpm_reload_modifier_inst_doublet = {
                IG1 = liberals
                IG2 = radicals
                INST = diplomacy
                MOD = bpm_diplomacy_libs_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = market_liberals
                INST = diplomacy
                MOD = bpm_diplomacy_marlibs_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = national_liberals
                INST = diplomacy
                MOD = bpm_diplomacy_natlibs_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = reactionaries
                INST = diplomacy
                MOD = bpm_diplomacy_reacs_modifier
            }
        bpm_reload_modifier_inst_triplet = {
                IG1 = reformist_socialists
                IG2 = revolutionist_socialists
                IG3 = socialists
                INST = diplomacy
                MOD = bpm_diplomacy_socs_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = diplomacy
                MOD = bpm_diplomacy_military_modifier
            }
        bpm_reload_modifier_inst_triplet = {
                IG1 = devout
                IG2 = landowners
                IG3 = petty_bourgeoisie
                INST = diplomacy
                MOD = bpm_diplomacy_neutraling_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = industrialists
                INST = diplomacy
                MOD = bpm_diplomacy_capis_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = diplomacy
                MOD = bpm_diplomacy_bureaucrats_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = diplomacy
                MOD = bpm_diplomacy_rf_modifier
            }
        bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = diplomacy
                MOD = bpm_diplomacy_tu_modifier
            }

            add_modifier = {
                name = bpm_diplomacy_attraction_modifier
                multiplier = owner.institution:institution_diplomacy.investment
            }
            add_modifier = bpm_number_of_cabinet_picks
        }
    }
}

bpm_remove_institution_modifiers_diplomacy = {
    remove_modifier = bpm_diplomacy_anarchists_modifier
    remove_modifier = bpm_diplomacy_socs_modifier
    remove_modifier = bpm_diplomacy_agpops_modifier
    remove_modifier = bpm_diplomacy_libs_modifier
    remove_modifier = bpm_diplomacy_natlibs_modifier
    remove_modifier = bpm_diplomacy_marlibs_modifier
    remove_modifier = bpm_diplomacy_cons_modifier
    remove_modifier = bpm_diplomacy_reacs_modifier
    remove_modifier = bpm_diplomacy_fash_modifier
    remove_modifier = bpm_diplomacy_neutraling_modifier
    remove_modifier = bpm_diplomacy_military_modifier
    remove_modifier = bpm_diplomacy_bureaucrats_modifier
    remove_modifier = bpm_diplomacy_capis_modifier
    remove_modifier = bpm_diplomacy_rf_modifier
    remove_modifier = bpm_diplomacy_tu_modifier
}

bpm_remove_institution_modifiers_suffrage = {
    remove_modifier = bpm_suffrage_agpops_modifier
    remove_modifier = bpm_suffrage_anarchists_modifier
    remove_modifier = bpm_suffrage_cons_modifier
    remove_modifier = bpm_suffrage_neutralidg_modifier
    remove_modifier = bpm_suffrage_lefts_modifier
    remove_modifier = bpm_suffrage_commies_modifier
    remove_modifier = bpm_suffrage_neutraling_modifier
    remove_modifier = bpm_suffrage_capis_modifier
    remove_modifier = bpm_suffrage_aris_modifier
    remove_modifier = bpm_suffrage_intel_modifier
    remove_modifier = bpm_suffrage_ruries_modifier
    remove_modifier = bpm_suffrage_unions_modifier
 }

bpm_remove_institution_modifiers_health_system = {
    remove_modifier = bpm_health_system_agpops_modifier
    remove_modifier = bpm_health_system_anarchists_modifier
    remove_modifier = bpm_health_system_centrists_modifier
    remove_modifier = bpm_health_system_lefts_modifier
    remove_modifier = bpm_health_system_commies_modifier
    remove_modifier = bpm_health_system_neutraling_modifier
    remove_modifier = bpm_health_system_military_modifier
    remove_modifier = bpm_health_system_pb_modifier
    remove_modifier = bpm_health_system_devout_modifier
    remove_modifier = bpm_health_system_capis_modifier
    remove_modifier = bpm_health_system_ruries_modifier
    remove_modifier = bpm_health_system_unions_modifier
 }
 

bpm_remove_institution_modifiers_culture = {
    remove_modifier = bpm_culture_fash_modifier
    remove_modifier = bpm_culture_natlibs_modifier
    remove_modifier = bpm_culture_neutralidg_modifier
    remove_modifier = bpm_culture_neutraling_modifier
 }

bpm_remove_institution_modifiers_centralization = {
    remove_modifier = bpm_centralization_agpops_modifier
    remove_modifier = bpm_centralization_cons_modifier
    remove_modifier = bpm_centralization_libs_modifier
    remove_modifier = bpm_centralization_neutralidg_modifier
    remove_modifier = bpm_centralization_neutraling_modifier
 }
 

bpm_remove_institution_modifiers_home_affairs = {
    remove_modifier = bpm_home_affairs_agpops_modifier
    remove_modifier = bpm_home_affairs_leftists_modifier
    remove_modifier = bpm_home_affairs_cons_modifier
    remove_modifier = bpm_home_affairs_reacs_modifier
    remove_modifier = bpm_home_affairs_liberals_modifier
    remove_modifier = bpm_home_affairs_pseudoleft_modifier
    remove_modifier = bpm_home_affairs_military_modifier
    remove_modifier = bpm_home_affairs_pb_modifier
    remove_modifier = bpm_home_affairs_neutraling_modifier
    remove_modifier = bpm_home_affairs_capis_modifier
    remove_modifier = bpm_home_affairs_intel_modifier
 }
 

bpm_remove_institution_modifiers_police = {
    remove_modifier = bpm_police_agpops_modifier
    remove_modifier = bpm_police_cons_modifier
    remove_modifier = bpm_police_fash_modifier
    remove_modifier = bpm_police_liberals_modifier
    remove_modifier = bpm_police_lefts_modifier
    remove_modifier = bpm_police_commies_modifier
    remove_modifier = bpm_police_military_modifier
    remove_modifier = bpm_police_pb_modifier
    remove_modifier = bpm_police_devout_modifier
    remove_modifier = bpm_police_capis_modifier
    remove_modifier = bpm_police_aris_modifier
    remove_modifier = bpm_police_intel_modifier
    remove_modifier = bpm_police_ruries_modifier
    remove_modifier = bpm_police_unions_modifier
 }
 

bpm_remove_institution_modifiers_workplace_safety = {
    remove_modifier = bpm_workplace_safety_agpops_modifier
    remove_modifier = bpm_workplace_safety_neutralidg_modifier
    remove_modifier = bpm_workplace_safety_lefts_modifier
    remove_modifier = bpm_workplace_safety_commies_modifier
    remove_modifier = bpm_workplace_safety_ruries_modifier
    remove_modifier = bpm_workplace_safety_unions_modifier
    remove_modifier = bpm_workplace_safety_neutraling_modifier
}
bpm_remove_institution_modifiers_social_security = {
    remove_modifier = bpm_social_security_rursocs_modifier
    remove_modifier = bpm_social_security_cons_modifier
    remove_modifier = bpm_social_security_liberals_modifier
    remove_modifier = bpm_social_security_lefts_modifier
    remove_modifier = bpm_social_security_commies_modifier
    remove_modifier = bpm_social_security_neutraling_modifier
    remove_modifier = bpm_social_security_pb_modifier
    remove_modifier = bpm_social_security_devout_modifier
    remove_modifier = bpm_social_security_capis_modifier
    remove_modifier = bpm_social_security_ruries_modifier
    remove_modifier = bpm_social_security_unions_modifier
 }
 

bpm_remove_institution_modifiers_colonial_affairs = {
    remove_modifier = bpm_colonial_affairs_cons_modifier
    remove_modifier = bpm_colonial_affairs_fash_modifier
    remove_modifier = bpm_colonial_affairs_libs_modifier
    remove_modifier = bpm_colonial_affairs_neutralidg_modifier
    remove_modifier = bpm_colonial_affairs_lefts_modifier
    remove_modifier = bpm_colonial_affairs_military_modifier
    remove_modifier = bpm_colonial_affairs_pb_modifier
    remove_modifier = bpm_colonial_affairs_devout_modifier
    remove_modifier = bpm_colonial_affairs_neutraling_modifier
    remove_modifier = bpm_colonial_affairs_attract_modifier
 }

bpm_remove_institution_modifiers_schools = {
    remove_modifier = bpm_schools_fallback_modifier
    remove_modifier = bpm_schools_agpops_modifier
    remove_modifier = bpm_schools_anarchists_modifier
    remove_modifier = bpm_schools_cons_modifier
    remove_modifier = bpm_schools_fash_modifier
    remove_modifier = bpm_schools_libs_modifier
    remove_modifier = bpm_schools_putsch_modifier
    remove_modifier = bpm_schools_lefts_modifier
    remove_modifier = bpm_schools_commies_modifier
    remove_modifier = bpm_schools_military_modifier
    remove_modifier = bpm_schools_pb_modifier
    remove_modifier = bpm_schools_devout_modifier
    remove_modifier = bpm_schools_capis_modifier
    remove_modifier = bpm_schools_intel_modifier
    remove_modifier = bpm_schools_ruries_modifier
    remove_modifier = bpm_schools_unions_modifier
 }
 
 bpm_reload_institution_modifiers_hog = {
    bpm_remove_institution_modifiers_hog = yes
    if = {
        limit = {
            bpm_antagonism_cached > 30
        }
        add_modifier = bpm_hog_antagonism_ultra_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 20
        }
        add_modifier = bpm_hog_antagonism_triple_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 10
        }
        add_modifier = bpm_hog_antagonism_double_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 0
        }
        add_modifier = bpm_hog_antagonism_modifier
    }
    
    if = {
        limit = {
            bpm_cab_synergy_value > 80
        }
        add_modifier = bpm_high_synergy_modifier
    }
    else_if = {
        limit = {
            bpm_cab_synergy_value > 60
        }
        add_modifier = bpm_mid_synergy_modifier
    }
    else = {
        add_modifier = bpm_low_synergy_modifier
    }
 }

 bpm_remove_institution_modifiers_hog = {
    remove_modifier = bpm_high_synergy_modifier
    remove_modifier = bpm_mid_synergy_modifier
    remove_modifier = bpm_low_synergy_modifier
    remove_modifier = bpm_hog_antagonism_modifier
    remove_modifier = bpm_hog_antagonism_double_modifier
    remove_modifier = bpm_hog_antagonism_triple_modifier
    remove_modifier = bpm_hog_antagonism_ultra_modifier
 }
# -- Cabinet Register Institutions (6) (Synergy table bis) --
bpm_cab_update_synergy = {
    clear_variable_list = bpm_synergy_calculation_charset

    bpm_fill_charset_with_cabmins = yes

    bpm_calculate_synergy = yes

    clear_variable_list = bpm_cabinet_disagreements
    set_variable = {
        name = bpm_cabinet_disagreement_governance
        value = {
            value = bpm_synergy_disagreement_governance_principle
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_cabinet_disagreement_democracy
        value = { 
            value = bpm_synergy_disagreement_democracy
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_cabinet_disagreement_slavery
        value = {
            value = bpm_synergy_disagreement_slavery
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_cabinet_disagreement_economy
        value = {
            value = bpm_synergy_disagreement_economy
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
    }
    if = {
        limit = {
            var:bpm_cabinet_disagreement_governance > 0
        }
        add_to_variable_list = {
            name = bpm_cabinet_disagreements
            target = active_law:lawgroup_governance_principles
        }
    }
    if = {
        limit = { var:bpm_cabinet_disagreement_democracy > 0 }
        add_to_variable_list = {
            name = bpm_cabinet_disagreements
            target = active_law:lawgroup_distribution_of_power
        }
    }
    if = {
        limit = { var:bpm_cabinet_disagreement_slavery > 0 }
        add_to_variable_list = {
            name = bpm_cabinet_disagreements
            target = active_law:lawgroup_slavery
        }
    }
    if = {
        limit = { var:bpm_cabinet_disagreement_economy > 0 }
        add_to_variable_list = {
            name = bpm_cabinet_disagreements
            target = active_law:lawgroup_economic_system
        }
    }


    set_variable = {
        name = bpm_cab_synergy
        value = {
            value = 1
            subtract = var:bpm_temp_synergy_calculation
        }
    }
    
    bpm_cab_update_antagonism = yes
    bpm_cab_update_hoshog_synergy = yes
}

bpm_cab_update_antagonism = {

    set_variable = {
        name = bpm_cached_antagonism
        value = bpm_antagonism
    }
    set_variable = {
        name = bpm_cached_antagonism_raw
        value = bpm_antagonism_raw
    }

}

bpm_cab_update_hoshog_synergy = {
    clear_variable_list = bpm_synergy_calculation_charset

    bpm_fill_charset_with_hoshog = yes

    bpm_calculate_synergy = yes

    clear_variable_list = bpm_hoshog_disagreements

    set_variable = {
        name = bpm_hoshog_disagreement_governance
        value = {
            value = bpm_synergy_disagreement_governance_principle
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_hoshog_disagreement_democracy
        value = { 
            value = bpm_synergy_disagreement_democracy
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_hoshog_disagreement_slavery
        value = {
            value = bpm_synergy_disagreement_slavery
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    set_variable = {
        name = bpm_hoshog_disagreement_economy
        value = {
            value = bpm_synergy_disagreement_economy
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    if = {
        limit = {
            var:bpm_hoshog_disagreement_governance > 0
        }
        add_to_variable_list = {
            name = bpm_hoshog_disagreements
            target = active_law:lawgroup_governance_principles
        }
    }
    if = {
        limit = { var:bpm_hoshog_disagreement_democracy > 0 }
        add_to_variable_list = {
            name = bpm_hoshog_disagreements
            target = active_law:lawgroup_distribution_of_power
        }
    }
    if = {
        limit = { var:bpm_hoshog_disagreement_slavery > 0 }
        add_to_variable_list = {
            name = bpm_hoshog_disagreements
            target = active_law:lawgroup_slavery
        }
    }
    if = {
        limit = { var:bpm_hoshog_disagreement_economy > 0 }
        add_to_variable_list = {
            name = bpm_hoshog_disagreements
            target = active_law:lawgroup_economic_system
        }
    }


    set_variable = {
        name = bpm_cab_hoshog_synergy
        value = {
            value = 1
            subtract = var:bpm_temp_synergy_calculation
        }
    }

}

bpm_calculate_synergy = {
    set_variable = {
        name = bpm_temp_synergy_calculation
        value = bpm_synergy_v3
    }
}
    #

bpm_fill_charset_with_cabmins = {
    bpm_fill_charset_with_cabmins_subp = { INST = schools }
    bpm_fill_charset_with_cabmins_subp = { INST = police }
    bpm_fill_charset_with_cabmins_subp = { INST = health_system }
    bpm_fill_charset_with_cabmins_subp = { INST = home_affairs }
    bpm_fill_charset_with_cabmins_subp = { INST = centralization }
    bpm_fill_charset_with_cabmins_subp = { INST = suffrage }
    bpm_fill_charset_with_cabmins_subp = { INST = culture }
    bpm_fill_charset_with_cabmins_subp = { INST = colonial_affairs }
    bpm_fill_charset_with_cabmins_subp = { INST = social_security }
    bpm_fill_charset_with_cabmins_subp = { INST = workplace_safety }
    bpm_fill_charset_with_cabmins_subp = { INST = diplomacy }
    bpm_fill_charset_with_cabmins_subp = { INST = economy }
}

bpm_fill_charset_with_hoshog = {
    if = {
        limit = {
            has_variable = bpm_headofgov
            exists = var:bpm_headofgov
        }
        add_to_variable_list = {
            name = bpm_synergy_calculation_charset
            target = var:bpm_headofgov
        }
    }
    add_to_variable_list = {
        name = bpm_synergy_calculation_charset
        target = ruler
    }
}

bpm_fill_charset_with_cabmins_subp = {
    if = {
        limit = {
            has_variable = bpm_minister_of_$INST$
            exists = var:bpm_minister_of_$INST$
        }
        add_to_variable_list = {
            name = bpm_synergy_calculation_charset
            target = var:bpm_minister_of_$INST$
        }
    }
}
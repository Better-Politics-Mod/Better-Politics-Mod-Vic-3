bpm_setup_decree_negotiation = {
	if = {
		limit = {
			enacting_any_law = yes
		}
		cancel_enactment = yes
	}
	set_variable = bpm_negotiation_banner_visible
	add_modifier = {
		name = bpm_in_negotiation
	}
	remove_variable = bpm_negotiation_type_constitution
	clear_variable_list = bpm_negotiation_targets
	clear_variable_list = bpm_negotiation_decree_concessions
	add_to_variable_list = {
		name = bpm_negotiation_targets
		target = scope:bpm_selected_law.type
	}
	every_interest_group = {

		# clear 
		remove_variable = bpm_pm_promised_ig

		save_scope_as = selected_ig
		owner = { every_in_list = {
			variable = bpm_negotiation_targets
			save_scope_as = selected_law_type
			scope:selected_ig = {
				set_variable = {
					name = bpm_negotiation_support_raw_cached
					value = bpm_negotiation_support_raw
				}		
			}
		} }
	}
	set_variable = bpm_negotiation_type_decree
}

bpm_cache_support_for_target_laws = {
	every_interest_group = {
		save_scope_as = selected_ig
		set_variable = {
			name = bpm_negotiation_support_raw_cached
			value = 0
		}
		owner = { every_in_list = {
			variable = bpm_negotiation_targets
			save_scope_as = selected_law_type
			scope:selected_ig = {
				change_variable = {
					name = bpm_negotiation_support_raw_cached
					add = bpm_negotiation_support_raw
				}		
			}
		} }
	}
}

bpm_end_decree_negotiation = {
	remove_modifier = bpm_in_negotiation
	remove_variable = bpm_negotiation_banner_visible
	remove_variable = bpm_negotiation_type_decree
	clear_variable_list = bpm_negotiation_targets
}

bpm_complete_decree_negotiation = {
	bpm_end_decree_negotiation = yes
	activate_law = var:bpm_decree_cooldown
	hidden_effect = { 
		bpm_determine_coup_severity = yes
	}
	save_scope_as = associated_country
	var:bpm_decree_cooldown = { 
		bpm_codification_set_decree = yes
	}
}

bpm_end_constitutional_drafting = {
	remove_modifier = bpm_in_negotiation
	remove_variable = bpm_negotiation_banner_visible
	remove_variable = bpm_negotiation_type_constitution
	clear_variable_list = bpm_negotiation_targets
}

bpm_approve_draft_constitution = {
	bpm_end_constitutional_drafting = yes
	add_modifier = bpm_in_negotiation
	every_interest_group = {
		if = {
			limit = {
				bpm_draft_support >= 50
			}
			add_ideology = ideology_constitution_supporter
		}
		else_if = {
			limit = {
				bpm_draft_support <= -50
			}
			add_ideology = ideology_constitution_opponent
		}
		else_if = {
			limit = {
				bpm_draft_support > -50
				bpm_draft_support < 0
			}
			add_ideology = ideology_constitution_wary
		}
		else_if = {
			limit = {
				bpm_draft_support >= 0
				bpm_draft_support < 50
			}
			add_ideology = ideology_constitution_reluctant
		}
	}
	start_enactment = law_type:law_repeatable_politics_approve_constitution
}

bpm_setup_constitutional_drafting = {
	if = {
		limit = {
			enacting_any_law = yes
		}
		cancel_enactment = yes
	}
	set_variable = bpm_negotiation_banner_visible
	add_modifier = {
		name = bpm_in_negotiation
	}
	remove_variable = bpm_negotiation_type_decree
	clear_variable_list = bpm_negotiation_targets
	clear_variable_list = bpm_negotiation_decree_concessions
	set_variable = bpm_negotiation_type_constitution
 
}
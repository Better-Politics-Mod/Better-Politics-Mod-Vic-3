# --CABGENSCRIPT--
bpm_reload_institution_modifiers = {

    # Go through the character's IG and find the appropriate modifier
    #if = {
    #    limit = {
    #        var:bpm_is_institution_schools.interest_group = {
    #            is_interest_group_type = ig_ruralk_folk
    #        }
    #    }
    #    add_modifier = {
    #        name = bpm_CAB_institution_schools_rural_folk_modifier
    #        multiplier = investment
    #   }
    #}
    
    every_interest_group = {
        remove_modifier = bpm_colonial_affairs_attraction_modifier
        remove_modifier = bpm_social_security_attraction_modifier
        remove_modifier = bpm_workplace_safety_attraction_modifier
        remove_modifier = bpm_schools_attraction_modifier
        remove_modifier = bpm_police_attraction_modifier
        remove_modifier = bpm_hog_attraction_modifier
    }

    bpm_reload_institution_modifiers_colonial_affairs = yes
    bpm_reload_institution_modifiers_social_security = yes
    bpm_reload_institution_modifiers_workplace_safety = yes
    bpm_reload_institution_modifiers_schools = yes
    bpm_reload_institution_modifiers_police = yes
    bpm_reload_institution_modifiers_hog = yes
    # trigger_event = { id = BPM_CAB_DEBUG_UTILS.2 days = 1 }
}

bpm_reload_modifier_inst_singlet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_doublet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_triplet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
                is_interest_group_type = ig_$IG3$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

bpm_reload_modifier_inst_quartet = {
    if = {
        limit = {
            OR = {
               is_interest_group_type = ig_$IG1$
               is_interest_group_type = ig_$IG2$    
                is_interest_group_type = ig_$IG3$
                is_interest_group_type = ig_$IG4$
            }
        }
        owner.institution:institution_$INST$ ?= {
            add_modifier = {
                name = $MOD$
                multiplier = owner.institution:institution_$INST$.investment
            }   
       }
   }
}

# -- Cabinet Register Institutions (Modifiers) --
# Please also modify BPM_CAB_interface.txt
# in custom locs. Also modify the locs in 
# BPM_cab_modifiers_l_english.yml for the UI to stay accurate.
bpm_reload_institution_modifiers_schools = {
    institution:institution_schools ?= {
        bpm_remove_institution_modifiers_schools = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_schools ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_schools
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_schools
        }
        var:bpm_is_institution_schools.interest_group = {

            bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = schools
                MOD = bpm_schools_agpops_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = anarchists
                INST = schools
                MOD = bpm_schools_anarchists_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = schools
                MOD = bpm_schools_cons_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = schools
                MOD = bpm_schools_fash_modifier
            }

            bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = schools
                MOD = bpm_schools_libs_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = schools
                MOD = bpm_schools_lefts_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = schools
                MOD = bpm_schools_commies_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = schools
                MOD = bpm_schools_military_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = schools
                MOD = bpm_schools_devout_modifier
            }

            bpm_reload_modifier_inst_doublet = {
                IG1 = landowners
                IG2 = industrialists
                INST = schools
                MOD = bpm_schools_capis_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = schools
                MOD = bpm_schools_intel_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = schools
                MOD = bpm_schools_pb_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = schools
                MOD = bpm_schools_ruries_modifier
            }

            bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = schools
                MOD = bpm_schools_unions_modifier
            }

            add_modifier = {
                name = bpm_schools_attraction_modifier
                multiplier = institution:institution_schools.investment
            }
        }
    }
}

bpm_reload_institution_modifiers_colonial_affairs = {
    institution:institution_colonial_affairs ?= {
        bpm_remove_institution_modifiers_colonial_affairs = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_colonial_affairs ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_colonial_affairs
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_colonial_affairs
        }
        var:bpm_is_institution_colonial_affairs.interest_group = {
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_cons_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_fash_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_libs_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = reformist_socialists
                IG2 = radicals
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_lefts_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_military_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_devout_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = industrialists
                IG2 = intelligentsia
                IG3 = landowners
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_neutraling_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = colonial_affairs
                MOD = bpm_colonial_affairs_pb_modifier
           }

            add_modifier = {
                name = bpm_colonial_affairs_attraction_modifier
                multiplier = institution:institution_colonial_affairs.investment
            }
        }
    }
}

bpm_reload_institution_modifiers_social_security = {
    institution:institution_social_security ?= {
        bpm_remove_institution_modifiers_social_security = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_social_security ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_social_security
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_social_security
        }
        var:bpm_is_institution_social_security.interest_group = {
           bpm_reload_modifier_inst_doublet = {
                IG1 = agrarian_populists
                IG2 = anarchists
                INST = social_security
                MOD = bpm_social_security_rursocs_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = conservatives
                INST = social_security
                MOD = bpm_social_security_cons_modifier
           }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = social_security
                MOD = bpm_social_security_liberals_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = radicals
                IG2 = reformist_socialists
                INST = social_security
                MOD = bpm_social_security_lefts_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = revolutionist_socialists
                IG2 = socialists
                INST = social_security
                MOD = bpm_social_security_commies_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = armed_forces
                IG2 = intelligentsia
                INST = social_security
                MOD = bpm_social_security_neutraling_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = social_security
                MOD = bpm_social_security_devout_modifier
           }
           bpm_reload_modifier_inst_doublet = {
                IG1 = industrialists
                IG2 = landowners
                INST = social_security
                MOD = bpm_social_security_capis_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = social_security
                MOD = bpm_social_security_pb_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = social_security
                MOD = bpm_social_security_ruries_modifier
           }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = social_security
                MOD = bpm_social_security_unions_modifier
           }

            add_modifier = {
                name = bpm_social_security_attraction_modifier
                multiplier = institution:institution_social_security.investment
            }
        }
    }
}
 
 bpm_reload_institution_modifiers_workplace_safety = {
    institution:institution_workplace_safety ?= {
        bpm_remove_institution_modifiers_workplace_safety = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_workplace_safety ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_workplace_safety
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_workplace_safety
        }
        var:bpm_is_institution_workplace_safety.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = workplace_safety
                MOD = bpm_workplace_safety_agpops_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = anarchists
                IG2 = radicals
                IG3 = reformist_socialists
                IG4 = socialists
                INST = workplace_safety
                MOD = bpm_workplace_safety_lefts_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = conservatives
                IG2 = liberals
                IG3 = market_liberals
                IG4 = national_liberals
                INST = workplace_safety
                MOD = bpm_workplace_safety_neutralidg_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = revolutionist_socialists
                INST = workplace_safety
                MOD = bpm_workplace_safety_commies_modifier
            }
           bpm_reload_modifier_inst_quartet = {
                IG1 = armed_forces
                IG2 = devout
                IG3 = intelligentsia
                IG4 = petty_bourgeoisie
                INST = workplace_safety
                MOD = bpm_workplace_safety_neutraling_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = workplace_safety
                MOD = bpm_workplace_safety_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = workplace_safety
                MOD = bpm_workplace_safety_unions_modifier
            }

            add_modifier = {
                name = bpm_workplace_safety_attraction_modifier
                multiplier = institution:institution_workplace_safety.investment
            }
        }
    }
}

bpm_reload_institution_modifiers_police = {
    institution:institution_police ?= {
        bpm_remove_institution_modifiers_police = yes
    }
    if = {
        limit = {
            var:bpm_is_institution_police ?= {
                OR = {
                    is_character_alive = no
                    NOT = { exists = interest_group } 
                }
            }
        }
        remove_variable = bpm_is_institution_police
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_police
        }
        var:bpm_is_institution_police.interest_group = {
           bpm_reload_modifier_inst_singlet = {
                IG1 = agrarian_populists
                INST = police
                MOD = bpm_police_agpops_modifier
            }
           bpm_reload_modifier_inst_doublet = {
                IG1 = conservatives
                IG2 = reactionaries
                INST = police
                MOD = bpm_police_cons_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = fascists
                INST = police
                MOD = bpm_police_fash_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = liberals
                IG2 = market_liberals
                IG3 = national_liberals
                INST = police
                MOD = bpm_police_liberals_modifier
            }
           bpm_reload_modifier_inst_triplet = {
                IG1 = radicals
                IG2 = reformist_socialists
                IG3 = socialists
                INST = police
                MOD = bpm_police_lefts_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = revolutionist_socialists
                INST = police
                MOD = bpm_police_commies_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = armed_forces
                INST = police
                MOD = bpm_police_military_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = devout
                INST = police
                MOD = bpm_police_devout_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = industrialists
                INST = police
                MOD = bpm_police_capis_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = intelligentsia
                INST = police
                MOD = bpm_police_intel_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = landowners
                INST = police
                MOD = bpm_police_aris_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = petty_bourgeoisie
                INST = police
                MOD = bpm_police_pb_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = rural_folk
                INST = police
                MOD = bpm_police_ruries_modifier
            }
           bpm_reload_modifier_inst_singlet = {
                IG1 = trade_unions
                INST = police
                MOD = bpm_police_unions_modifier
            }

            add_modifier = {
                name = bpm_police_attraction_modifier
                multiplier = institution:institution_police.investment
            }
        }
    }
}

bpm_remove_institution_modifiers_police = {
    remove_modifier = bpm_police_agpops_modifier
    remove_modifier = bpm_police_cons_modifier
    remove_modifier = bpm_police_fash_modifier
    remove_modifier = bpm_police_liberals_modifier
    remove_modifier = bpm_police_lefts_modifier
    remove_modifier = bpm_police_commies_modifier
    remove_modifier = bpm_police_military_modifier
    remove_modifier = bpm_police_pb_modifier
    remove_modifier = bpm_police_devout_modifier
    remove_modifier = bpm_police_capis_modifier
    remove_modifier = bpm_police_aris_modifier
    remove_modifier = bpm_police_intel_modifier
    remove_modifier = bpm_police_ruries_modifier
    remove_modifier = bpm_police_unions_modifier
 }
 

bpm_remove_institution_modifiers_workplace_safety = {
    remove_modifier = bpm_workplace_safety_agpops_modifier
    remove_modifier = bpm_workplace_safety_neutralidg_modifier
    remove_modifier = bpm_workplace_safety_lefts_modifier
    remove_modifier = bpm_workplace_safety_commies_modifier
    remove_modifier = bpm_workplace_safety_ruries_modifier
    remove_modifier = bpm_workplace_safety_unions_modifier
    remove_modifier = bpm_workplace_safety_neutraling_modifier
}

bpm_remove_institution_modifiers_social_security = {
    remove_modifier = bpm_social_security_rursocs_modifier
    remove_modifier = bpm_social_security_cons_modifier
    remove_modifier = bpm_social_security_liberals_modifier
    remove_modifier = bpm_social_security_lefts_modifier
    remove_modifier = bpm_social_security_commies_modifier
    remove_modifier = bpm_social_security_neutraling_modifier
    remove_modifier = bpm_social_security_pb_modifier
    remove_modifier = bpm_social_security_devout_modifier
    remove_modifier = bpm_social_security_capis_modifier
    remove_modifier = bpm_social_security_ruries_modifier
    remove_modifier = bpm_social_security_unions_modifier
 }
 

bpm_remove_institution_modifiers_colonial_affairs = {
    remove_modifier = bpm_colonial_affairs_cons_modifier
    remove_modifier = bpm_colonial_affairs_fash_modifier
    remove_modifier = bpm_colonial_affairs_libs_modifier
    remove_modifier = bpm_colonial_affairs_neutralidg_modifier
    remove_modifier = bpm_colonial_affairs_lefts_modifier
    remove_modifier = bpm_colonial_affairs_military_modifier
    remove_modifier = bpm_colonial_affairs_pb_modifier
    remove_modifier = bpm_colonial_affairs_devout_modifier
    remove_modifier = bpm_colonial_affairs_neutraling_modifier
    remove_modifier = bpm_colonial_affairs_attract_modifier
 }

bpm_remove_institution_modifiers_schools = {
    remove_modifier = bpm_schools_fallback_modifier
    remove_modifier = bpm_schools_agpops_modifier
    remove_modifier = bpm_schools_anarchists_modifier
    remove_modifier = bpm_schools_cons_modifier
    remove_modifier = bpm_schools_fash_modifier
    remove_modifier = bpm_schools_libs_modifier
    remove_modifier = bpm_schools_putsch_modifier
    remove_modifier = bpm_schools_lefts_modifier
    remove_modifier = bpm_schools_commies_modifier
    remove_modifier = bpm_schools_military_modifier
    remove_modifier = bpm_schools_pb_modifier
    remove_modifier = bpm_schools_devout_modifier
    remove_modifier = bpm_schools_capis_modifier
    remove_modifier = bpm_schools_intel_modifier
    remove_modifier = bpm_schools_ruries_modifier
    remove_modifier = bpm_schools_unions_modifier
 }
 
 bpm_reload_institution_modifiers_hog = {
    bpm_remove_institution_modifiers_hog = yes
    if = {
        limit = {
            bpm_antagonism_cached > 30
        }
        add_modifier = bpm_hog_antagonism_ultra_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 20
        }
        add_modifier = bpm_hog_antagonism_triple_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 10
        }
        add_modifier = bpm_hog_antagonism_double_modifier
    }
    else_if = {
        limit = {
            bpm_antagonism_cached > 0
        }
        add_modifier = bpm_hog_antagonism_modifier
    }
    
    if = {
        limit = {
            bpm_cab_synergy_value > 60
        }
        add_modifier = bpm_high_synergy_modifier
    }
    else_if = {
        limit = {
            bpm_cab_synergy_value > 30
        }
        add_modifier = bpm_mid_synergy_modifier
    }
    else = {
        add_modifier = bpm_low_synergy_modifier
    }
 }

 bpm_remove_institution_modifiers_hog = {
    remove_modifier = bpm_high_synergy_modifier
    remove_modifier = bpm_mid_synergy_modifier
    remove_modifier = bpm_low_synergy_modifier
    remove_modifier = bpm_hog_antagonism_modifier
    remove_modifier = bpm_hog_antagonism_double_modifier
    remove_modifier = bpm_hog_antagonism_triple_modifier
    remove_modifier = bpm_hog_antagonism_ultra_modifier
 }
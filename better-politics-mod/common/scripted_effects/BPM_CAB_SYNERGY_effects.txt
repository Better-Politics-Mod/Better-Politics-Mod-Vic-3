bpm_cab_update_synergy = {
    set_variable = {
        name = bpm_cab_synergy
        value = 0
    }
    set_variable = {
        name = bpm_cab_synergy_total
        value = 0
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_colonial_affairs
        }
        bpm_cab_update_synergy_ind = {
            INST1 = colonial_affairs
            INST2 = police
            VAL = 0.2
        }
        bpm_cab_update_synergy_hog = {
            INST = colonial_affairs
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_social_security
        }
        bpm_cab_update_synergy_ind = {
            INST1 = social_security
            INST2 = workplace_safety
            VAL = 0.8
        }
        bpm_cab_update_synergy_hog = {
            INST = social_security
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_workplace_safety
        }
        bpm_cab_update_synergy_ind = {
            INST1 = workplace_safety
            INST2 = police
            VAL = 0.2
        }
        bpm_cab_update_synergy_ind = {
            INST1 = workplace_safety
            INST2 = health_system
            VAL = 0.4
        }
        bpm_cab_update_synergy_ind = {
            INST1 = workplace_safety
            INST2 = home_affairs
            VAL = 0.2
        }
        bpm_cab_update_synergy_hog = {
            INST = workplace_safety
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_schools
        }
        bpm_cab_update_synergy_ind = {
            INST1 = schools
            INST2 = health_system
            VAL = 0.1
        }
        bpm_cab_update_synergy_ind = {
            INST1 = schools
            INST2 = home_affairs
            VAL = 0.2
        }
        bpm_cab_update_synergy_ind = {
            INST1 = schools
            INST2 = centralization
            VAL = 0.2
        }
        bpm_cab_update_synergy_ind = {
            INST1 = schools
            INST2 = suffrage
            VAL = 0.1
        }
        bpm_cab_update_synergy_ind = {
            INST1 = schools
            INST2 = culture
            VAL = 0.6
        }
        bpm_cab_update_synergy_hog = {
            INST = schools
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_police
        }
        bpm_cab_update_synergy_ind = {
            INST1 = police
            INST2 = home_affairs
            VAL = 0.8
        }
        bpm_cab_update_synergy_ind = {
            INST1 = police
            INST2 = centralizaiton
            VAL = 0.2
        }
        bpm_cab_update_synergy_hog = {
            INST = police
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_health_system
        }
        bpm_cab_update_synergy_ind = {
            INST1 = health_system
            INST2 = home_affairs
            VAL = 0.1
        }
        bpm_cab_update_synergy_hog = {
            INST = health_system
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_home_affairs
        }
        bpm_cab_update_synergy_ind = {
            INST1 = home_affairs
            INST2 = centralization
            VAL = 0.4
        }
        bpm_cab_update_synergy_ind = {
            INST1 = home_affairs
            INST2 = suffrage
            VAL = 0.2
        }
        bpm_cab_update_synergy_ind = {
            INST1 = home_affairs
            INST2 = culture
            VAL = 0.6
        }
        bpm_cab_update_synergy_hog = {
            INST = home_affairs
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_centralization
        }
        bpm_cab_update_synergy_ind = {
            INST1 = centralization
            INST2 = suffrage
            VAL = 0.4
        }
        bpm_cab_update_synergy_ind = {
            INST1 = centralization
            INST2 = culture
            VAL = 0.6
        }
        bpm_cab_update_synergy_hog = {
            INST = centralization
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_suffrage
        }
        bpm_cab_update_synergy_ind = {
            INST1 = suffrage
            INST2 = culture
            VAL = 0.2
        }
        bpm_cab_update_synergy_hog = {
            INST = suffrage
        }
    }
    if = {
        limit = {
            has_variable = bpm_is_institution_culture
        }
        bpm_cab_update_synergy_hog = {
            INST = culture
        }
    }


    # Get the synergy value
    # as a percentage of the maximum synergy value
    if = {
        limit = {
            var:bpm_cab_synergy_total = 0
        }
        change_variable = {
            name = bpm_cab_synergy
            add = 1
        }
    }
    else = {
        change_variable = {
            name = bpm_cab_synergy
            divide = var:bpm_cab_synergy_total
        }
    }

}

bpm_cab_update_synergy_ind = {
    if = {
        limit = {
            has_variable = bpm_is_institution_$INST2$
        }
        var:bpm_is_institution_$INST1$ = {
            save_scope_as = BPM_CHAR_1
        }
        var:bpm_is_institution_$INST2$ = {
            save_scope_as = BPM_CHAR_2
        }
        save_scope_value_as = {
            name = BPM_CALC_SYN_MULT
            value = $VAL$
        }
        change_variable = {
            name = bpm_cab_synergy
            add = BPM_CALC_SYN
        }
        change_variable = {
            name = bpm_cab_synergy_total
            add = scope:BPM_CALC_SYN_MULT
        }
    }
}

bpm_cab_update_synergy_hog = {
    if = {
        limit = {
            has_variable = bpm_headofgov
        }
        var:bpm_is_institution_$INST$ = {
            save_scope_as = BPM_CHAR_1
        }
        var:bpm_headofgov = {
            save_scope_as = BPM_CHAR_2
        }
        save_scope_value_as = {
            name = BPM_CALC_SYN_MULT
            value = 0.5
        }
        change_variable = {
            name = bpm_cab_synergy
            add = BPM_CALC_SYN
        }
        change_variable = {
            name = bpm_cab_synergy_total
            add = scope:BPM_CALC_SYN_MULT
        }
    }
}

bpm_cab_character_calculate_hyp_synergy = {
    save_scope_as = BPM_CHAR_1
    owner = {
        set_variable = {
            name = bpm_cab_hyp_synergy
            value = 0
        }
        set_variable = {
            name = bpm_cab_hyp_synergy_total
            value = 0
        }

        if = {
            limit = {
                has_variable = bpm_is_institution_colonial_affairs
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_colonial_affairs.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = police
                VAL = 0.2
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_social_security
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_social_security.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = workplace_safety
                VAL = 0.8
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_workplace_safety
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_workplace_safety.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = police
                VAL = 0.2
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = health_system
                VAL = 0.4
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = home_affairs
                VAL = 0.2
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_schools
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_schools.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = health_system
                VAL = 0.1
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = home_affairs
                VAL = 0.2
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = centralization
                VAL = 0.2
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = suffrage
                VAL = 0.1
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = culture
                VAL = 0.6
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_police
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_police.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = home_affairs
                VAL = 0.8
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = centralizaiton
                VAL = 0.2
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_health_system
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_health_system.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = home_affairs
                VAL = 0.1
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_home_affairs
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_home_affairs.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = centralization
                VAL = 0.4
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = suffrage
                VAL = 0.2
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = culture
                VAL = 0.6
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_centralization
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_centralization.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = suffrage
                VAL = 0.4
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = culture
                VAL = 0.6
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_suffrage
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_suffrage.type }
            }
            bpm_cab_update_synergy_ind_sub = {
                INST = culture
                VAL = 0.2
            }
        }
        if = {
            limit = {
                has_variable = bpm_is_institution_culture
                NOT = { var:bpm_cabinet_char_select.type ?= institution:institution_culture.type }
            }
        }
        bpm_cab_update_synergy_hog = yes
        if = {
            limit = {
                var:bpm_cab_synergy_total = 0
            }
            change_variable = {
                name = bpm_cab_hyp_synergy
                add = 1
            }
        }
        else = {
            change_variable = {
                name = bpm_cab_hyp_synergy
                divide = var:bpm_cab_synergy_total
            }
        }
    }
    set_variable = {
        name = bpm_cab_char_synergy
        value = owner.var:bpm_cab_hyp_synergy
    }
}

bpm_cab_update_synergy_ind_sub = {
    if = {
        limit = {
            has_variable = bpm_is_institution_$INST$
        }
        var:bpm_is_institution_$INST$ = {
            save_scope_as = BPM_CHAR_2
        }
        save_scope_value_as = {
            name = BPM_CALC_SYN_MULT
            value = $VAL$
        }
        change_variable = {
            name = bpm_cab_hyp_synergy
            add = BPM_CALC_SYN
        }
        change_variable = {
            name = bpm_cab_hyp_synergy_total
            add = scope:BPM_CALC_SYN_MULT
        }
    }
}

bpm_cab_update_synergy_hog_sub = {
    if = {
        limit = {
            has_variable = bpm_headofgov
        }
        var:bpm_headofgov = {
            save_scope_as = BPM_CHAR_2
        }
        save_scope_value_as = {
            name = BPM_CALC_SYN_MULT
            value = 0.5
        }
        change_variable = {
            name = bpm_cab_synergy
            add = BPM_CALC_SYN
        }
        change_variable = {
            name = bpm_cab_synergy_total
            add = scope:BPM_CALC_SYN_MULT
        }
    }
}
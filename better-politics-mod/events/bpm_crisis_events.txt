namespace = bpm_state_crisis

bpm_state_crisis.1 = { 
	type = country_event
	placement = root

	event_image = {
		video = "votp_conspiring"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/europenorthamerica/political_extremism"
	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	title = bpm_state_crisis.1.t
	desc = bpm_state_crisis.1.d
	flavor = bpm_state_crisis.1.f
	duration = 1

	dlc = dlc_bpm

	immediate = {
        set_variable = bpm_active_sticky_crisis
        set_variable = {
            name = bpm_crisis_cooldown
            value = 36
        }
        add_journal_entry = { type = je_bpm_crisis_of_the_state }
	}   

	option = { 
		name = bpm_state_crisis.1.a
		default_option = yes
        activate_law = law_type:law_censorship
        change_infamy = 5
        add_modifier = {
            name = bpm_crisis_movement_crackdown
            months = 24
        }
	}

    option = { 
		name = bpm_state_crisis.1.b
		activate_law = law_type:law_protected_speech
        add_modifier = {
            name = bpm_crisis_movement_radicalism
            months = 24
        }
	}
}

bpm_state_crisis.2 = {
	type = country_event
	placement = root
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	title = bpm_state_crisis.2.t
	desc = bpm_state_crisis.2.d
	flavor = bpm_state_crisis.2.f

	duration = 3

	trigger = {
		authority <= 0
		has_variable = bpm_auth_shortage_weeks
		var:bpm_auth_shortage_weeks > 4
		has_variable = bpm_auth_state_exhaustion
		var:bpm_auth_state_exhaustion >= 500
		any_interest_group = {
			is_in_government = yes
			is_marginal = no
			bpm_ig_is_state_institutional = no
			any_preferred_law = {
				law_is_valid_for_ig_petition = yes
				NOT = { is_same_law_group_as = law_type:law_monarchy }
				NOT = { is_same_law_group_as = law_type:law_appointed_on_advice }
				NOT = { is_same_law_group_as = law_type:law_supreme_legislature }
			}
		}
	}

	immediate = {
		random_interest_group = {
            limit = {
                is_in_government = yes
                is_marginal = no
				bpm_ig_is_state_institutional = no
                any_preferred_law = {
                    law_is_valid_for_ig_petition = yes
					NOT = { is_same_law_group_as = law_type:law_monarchy }
					NOT = { is_same_law_group_as = law_type:law_appointed_on_advice }
					NOT = { is_same_law_group_as = law_type:law_supreme_legislature }
                }
            }
            save_scope_as = bpm_opportunist_ig
            ordered_preferred_law = {
                limit = {
					law_is_valid_for_ig_petition = yes
					NOT = { is_same_law_group_as = law_type:law_monarchy }
					NOT = { is_same_law_group_as = law_type:law_appointed_on_advice }
					NOT = { is_same_law_group_as = law_type:law_supreme_legislature }
                }
                min = 0 
                max = 2
                check_range_bounds = no
                save_scope_as = bpm_opportunist_law
            }
			ordered_preferred_law = {
                limit = {
					law_is_valid_for_ig_petition = yes
					NOT = { is_same_law_group_as = law_type:law_monarchy }
					NOT = { is_same_law_group_as = law_type:law_appointed_on_advice }
					NOT = { is_same_law_group_as = law_type:law_supreme_legislature }
					NOT = {
						scope:bpm_opportunist_law ?= THIS
					}
                }
                min = 1 
                max = 3
                check_range_bounds = no
                save_scope_as = bpm_opportunist_law_2
            }
        }
	}

	cancellation_trigger = {

	}
	
	option = {
		name = bpm_state_crisis.2.a
		default_option = yes
		show_as_unavailable = {
			always = yes
		}
		trigger = {
			authority > 0
		}
		scope:bpm_opportunist_ig = {
			add_modifier = {
				years = 2
				is_decaying = yes
				name = bpm_annoyed
			}
		}
		bpm_auth_add_exhaustion_small = yes
	}

	option = {
		name = bpm_state_crisis.2.b
		activate_law = scope:bpm_opportunist_law.type
		scope:bpm_opportunist_ig = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		bpm_auth_remove_exhaustion_large = yes
	}
	
	option = {
		name = bpm_state_crisis.2.c
		trigger = {
			exists = scope:bpm_opportunist_law_2
		}
		activate_law = scope:bpm_opportunist_law_2.type
		scope:bpm_opportunist_ig = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		bpm_auth_remove_exhaustion_normal = yes
	}
}

bpm_state_crisis.3 = {
	type = country_event
	placement = root
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	title = bpm_state_crisis.3.t
	desc = bpm_state_crisis.3.desc
	flavor = bpm_state_crisis.3.f

	duration = 3

	trigger = {
		authority <= 0
		has_variable = bpm_auth_shortage_weeks
		var:bpm_auth_shortage_weeks > 4
		has_variable = bpm_auth_state_exhaustion
		var:bpm_auth_state_exhaustion >= 500
		ig:ig_armed_forces ?= {
			is_marginal = no
		}

		OR = {
			has_law = law_type:law_elected_officers
			AND = {
				can_enact = law_type:law_national_guard
				NOT = { has_law = law_type:law_secret_police }
				NOT = { has_law = law_type:law_national_guard }
			}
			AND = {
				can_enact = law_type:law_militarized_police
				NOT = { has_law = law_type:law_militarized_police }
			}
			AND = {
				can_enact = law_type:law_military_junta
				authority < 0
			}
		}
	}

	immediate = {
		
	}

	cancellation_trigger = {

	}
	
	option = {
		name = bpm_state_crisis.3.a
		default_option = yes
		show_as_unavailable = {
			always = yes
		}
		trigger = {
			authority <= 0
		}
		bpm_auth_add_exhaustion_small = yes
		ig:ig_armed_forces = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_displeased
			}
		}
		every_interest_group = {
			limit = { is_in_government = yes bpm_ig_is_anarchist = no }
			add_modifier = {
				years = 2
				is_decaying = yes
				name = bpm_annoyed
			}
		}
	}

	option = {
		name = bpm_state_crisis.3.b
		trigger = {
			has_law = law_type:law_elected_officers
		}
		activate_law = law_type:law_professional_officers
		bpm_auth_remove_exhaustion_large = yes
		ig:ig_armed_forces = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
	}

	option = {
		name = bpm_state_crisis.3.c
		trigger = {
			OR = {
				AND = {
					can_enact = law_type:law_national_guard
					NOT = { has_law = law_type:law_secret_police }
					NOT = { has_law = law_type:law_national_guard }
				}
				AND = {
					can_enact = law_type:law_militarized_police
					NOT = { has_law = law_type:law_militarized_police }
				}
			}
		}
		if = {
			limit = {
				can_enact = law_type:law_national_guard
				NOT = { has_law = law_type:law_secret_police }
				NOT = { has_law = law_type:law_national_guard }
			}
			activate_law = law_type:law_national_guard
		}
		if = {
			limit = {
				can_enact = law_type:law_militarized_police
				NOT = { has_law = law_type:law_militarized_police }
			}
			activate_law = law_type:law_militarized_police
		}
		bpm_auth_remove_exhaustion_large = yes
		ig:ig_armed_forces = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
	}

	option = {
		name = bpm_state_crisis.3.d
		trigger = {
			can_enact = law_type:law_military_junta
			NOT = { has_law = law_type:law_military_junta }
		}
		activate_law = law_type:law_military_junta
		bpm_auth_remove_exhaustion_huge = yes
		ig:ig_armed_forces = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		add_modifier = {
			years = 5
			is_decaying = yes
			name = bpm_recent_junta
		}
	}
}

bpm_state_crisis.4 = {
	type = country_event
	placement = root
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	title = bpm_state_crisis.4.t
	desc = bpm_state_crisis.4.desc
	flavor = bpm_state_crisis.4.f

	duration = 3

	trigger = {
		authority <= 0
		has_variable = bpm_auth_shortage_weeks
		var:bpm_auth_shortage_weeks > 4
		has_variable = bpm_auth_state_exhaustion
		var:bpm_auth_state_exhaustion >= 500
		ig:ig_petty_bourgeoisie ?= {
			is_marginal = no
		}

		OR = {
			AND = {
				can_enact = law_type:law_secret_police
				NOT = { has_law = law_type:law_secret_police }
			}
			AND = {
				can_enact = law_type:law_outlawed_dissent
				NOT = { has_law = law_type:law_outlawed_dissent }
				has_law = law_type:law_censorship
			}
			AND = {
				can_enact = law_type:law_censorship
				NOT = { has_law = law_type:law_censorship }
				NOT = { has_law = law_type:law_outlawed_dissent }
			}
			has_law = law_type:law_elected_police
			country_has_voting_franchise = yes
			NOT = { has_law = law_type:law_ad_hoc_centralization }
		}
	}

	immediate = {
		
	}

	cancellation_trigger = {

	}
	
	option = {
		name = bpm_state_crisis.4.a
		default_option = yes
		show_as_unavailable = {
			always = yes
		}
		trigger = {
			authority > 0
		}
		bpm_auth_add_exhaustion_small = yes
		ig:ig_petty_bourgeoisie = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_displeased
			}
		}
		every_interest_group = {
			limit = { is_in_government = yes bpm_ig_is_anarchist = no }
			add_modifier = {
				years = 2
				is_decaying = yes
				name = bpm_annoyed
			}
		}
	}

	option = {
		name = bpm_state_crisis.4.b
		trigger = {
			OR = {
				AND = {
					can_enact = law_type:law_secret_police
					NOT = { has_law = law_type:law_secret_police }
				}
				AND = {
					can_enact = law_type:law_outlawed_dissent
					NOT = { has_law = law_type:law_outlawed_dissent }
					has_law = law_type:law_censorship
				}
				AND = {
					can_enact = law_type:law_censorship
					NOT = { has_law = law_type:law_censorship }
					NOT = { has_law = law_type:law_outlawed_dissent }
				}
			}
		}
		if = {
			limit = {
				can_enact = law_type:law_secret_police
				NOT = { has_law = law_type:law_secret_police }
			}
			activate_law = law_type:law_secret_police
		}
		if = {
			limit = {
				can_enact = law_type:law_outlawed_dissent
				NOT = { has_law = law_type:law_outlawed_dissent }
				has_law = law_type:law_censorship
			}
			activate_law = law_type:law_outlawed_dissent
		} else_if = {
			limit = {
				can_enact = law_type:law_censorship
				NOT = { has_law = law_type:law_censorship }
				NOT = { has_law = law_type:law_outlawed_dissent }
			}
			activate_law = law_type`:law_censorship
		}
		ig:ig_petty_bourgeoisie = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		bpm_auth_remove_exhaustion_large = yes
	}

	option = {
		name = bpm_state_crisis.4.c
		trigger = {
			has_law = law_type:law_elected_police
		}
		activate_law = law_type:law_dedicated_police
		ig:ig_petty_bourgeoisie = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		bpm_auth_remove_exhaustion_large = yes
	}

	option = {
		name = bpm_state_crisis.4.d
		trigger = {
			country_has_voting_franchise = yes
		}
		activate_law = law_type:law_oligarchy
		ig:ig_petty_bourgeoisie = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		bpm_auth_remove_exhaustion_large = yes
	}

	option = {
		name = bpm_state_crisis.4.e
		trigger = {
			NOT = { has_law = law_type:law_ad_hoc_centralization }
		}
		activate_law = law_type:law_ad_hoc_centralization
		ig:ig_petty_bourgeoisie = {
			add_modifier = {
				years = 5
				is_decaying = yes
				name = bpm_pleased
			}
		}
		add_modifier = {
			name = bpm_crisis_bureaucratic_fiefdoms
		}
		bpm_auth_remove_exhaustion_huge = yes
	}
}
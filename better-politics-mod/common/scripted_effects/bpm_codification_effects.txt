bpm_codification_set_traditional = {
    scope:associated_country = { add_to_variable_list = {
        name = bpm_codification_traditional_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_decree_laws
        target = prev
    }
    remove_list_variable = {
        name = bpm_codification_legal_laws
        target = prev
    }
    remove_list_variable = {
        name = bpm_codification_constitutional_laws
        target = prev
    }
    }
}

bpm_codification_set_decree = {
    scope:associated_country = { add_to_variable_list = {
        name = bpm_codification_decree_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_traditional_laws
        target = prev
    }
    remove_list_variable = {
        name = bpm_codification_legal_laws
        target = prev
    }
    remove_list_variable = {
        name = bpm_codification_constitutional_laws
        target = prev
    }
    }
}

bpm_codification_set_legal = {
    scope:associated_country = { add_to_variable_list = {
        name = bpm_codification_legal_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_traditional_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_decree_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_constitutional_laws
        target = prev
    }
    }
}

bpm_codification_set_constitutional = {
    scope:associated_country = { add_to_variable_list = {
        name = bpm_codification_constitutional_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_traditional_laws
        target = prev
    }
    remove_list_variable = {
        name = bpm_codification_decree_laws
        target = prev
    } 
    remove_list_variable = {
        name = bpm_codification_legal_laws
        target = prev
    }
    }
}

bpm_codification_mark_as_possible_traditional = {
    add_to_global_variable_list = {
        name = bpm_codification_possible_traditional_laws
        target = this
    }
}

bpm_codification_mark_as_possible_decree = {
    add_to_global_variable_list = {
        name = bpm_codification_possible_decree_laws
        target = this
    }
}

bpm_codification_mark_as_possible_legal = {
    add_to_global_variable_list = {
        name = bpm_codification_possible_legal_laws
        target = this
    }
}

bpm_codification_mark_as_possible_constitutional = {
    add_to_global_variable_list = {
        name = bpm_codification_possible_constitutional_laws
        target = this
    }
}

bpm_setup_codification_pre_constitutional = {
    if = {
        limit = { 
            scope:law_type = { OR = { 
               is_same_law_group_as = law_type:law_monarchy 
               is_same_law_group_as = law_type:law_appointed_on_advice 
               is_same_law_group_as = law_type:law_advisory_body    
            } }
        }
        type = { 
            bpm_codification_set_traditional = yes
        }
    }
}

bpm_setup_codification = {
    save_scope_as = associated_country
    
    every_law = {
        type = {
            save_scope_as = law_type
        }
        if = { 
            limit = {
                scope:law_type = { OR = { 
                    is_same_law_group_as = law_type:law_repeatable_culture_none
                    is_same_law_group_as = law_type:law_repeatable_economy_none
                    is_same_law_group_as = law_type:law_repeatable_military_none
                    is_same_law_group_as = law_type:law_repeatable_politics_none
                    is_same_law_group_as = law_type:law_repeatable_religion_none
                } }
            }
            type = { 
                bpm_codification_set_legal = yes
                bpm_codification_mark_as_possible_legal = yes
            }
        }
        else_if = {
            limit = {
                scope:law_type = { OR = { 
                    is_same_law_group_as = law_type:law_monarchy
                    is_same_law_group_as = law_type:law_advisory_body    
                    is_same_law_group_as = law_type:law_appointed_on_advice
                } }
            }
            type = {
                bpm_codification_set_constitutional = yes
                bpm_codification_mark_as_possible_traditional = yes    
                bpm_codification_mark_as_possible_decree = yes
                bpm_codification_mark_as_possible_legal = yes
                bpm_codification_mark_as_possible_constitutional = yes    
            }
        }
        else_if = {
            limit = {
                type = law_type:law_extraction_economy
            }
            type = {
                bpm_codification_set_constitutional = yes
                bpm_codification_mark_as_possible_decree = yes
                bpm_codification_mark_as_possible_legal = yes
                bpm_codification_mark_as_possible_constitutional = yes    
            }
        }
        else_if = {
            limit = {
                OR = {
                    type = law_type:law_ad_hoc_centralization
                    type = law_type:law_premodern_diplomacy
                    type = law_type:law_traditionalism
                    type = law_type:law_no_police
                    type = law_type:law_no_schools
                    type = law_type:law_no_health_system
                    type = law_type:law_traditional_ostracism
                }
            }
            type = {
                bpm_codification_set_traditional = yes
                bpm_codification_mark_as_possible_traditional = yes    
            }
        }
        else_if = {
            limit = {
                OR = {
                    type = law_type:law_autocracy
                    type = law_type:law_national_supremacy     
                }
            }
            type = {
                bpm_codification_set_traditional = yes
                bpm_codification_mark_as_possible_traditional = yes    
                bpm_codification_mark_as_possible_decree = yes
                bpm_codification_mark_as_possible_legal = yes
                bpm_codification_mark_as_possible_constitutional = yes    
            }
        }
        else_if = {
            limit = {
                scope:law_type = { OR = { 
                    is_same_law_group_as = law_type:law_ad_hoc_centralization
                    is_same_law_group_as = law_type:law_premodern_diplomacy    
                    is_same_law_group_as = law_type:law_traditionalism
                    is_same_law_group_as = law_type:law_no_police
                    is_same_law_group_as = law_type:law_no_schools    
                    is_same_law_group_as = law_type:law_no_health_system
                    is_same_law_group_as = law_type:law_traditional_ostracism

                } }
            }
            type = {
                bpm_codification_set_legal = yes
                bpm_codification_mark_as_possible_decree = yes
                bpm_codification_mark_as_possible_legal = yes
                bpm_codification_mark_as_possible_constitutional = yes    
            }
        }
        else = {
            type = {
                bpm_codification_set_legal = yes
                bpm_codification_mark_as_possible_traditional = yes    
                bpm_codification_mark_as_possible_decree = yes
                bpm_codification_mark_as_possible_legal = yes
                bpm_codification_mark_as_possible_constitutional = yes    
            }

        }

        if = {
            limit = {
                scope:associated_country = { bpm_country_is_pre_constitutional = yes }
            }
            bpm_setup_codification_pre_constitutional = yes
        }
    }
}

bpm_determine_coup_severity = { 
    #// Trigger events for every scenario

    if = {
        limit = {
            bpm_has_legal_authority_to_do_change = yes
        }
        set_variable = {
            name = bpm_decree_actual_success
            value = { integer_range = { min = 0 max = 10 } }
        }
        if = {
            limit = { 
                has_variable = bpm_decree_actual_success
                bpm_codification_decree_support > var:bpm_decree_actual_success
            }
            #// do success stuff
            trigger_event = { id = bpm_codification_events.3 popup = yes  days = { 7 60 } }
        }
        else = { 
            #// do failure stuff
            trigger_event = { id = bpm_codification_events.2 popup = yes days = { 7 60 } }
            #//activate_law = var:bpm_decree_cooldown_current_law
        }
    }
    else_if = { 
        set_variable = {
            name = bpm_decree_actual_success
            value = { integer_range = { min = 5 max = 15 } }
        }
        set_variable = {
            name = bpm_decree_actual_massive_success
            value = {
                value = var:bpm_decree_actual_success
                add = 2
                min = 8
            }
        }
        set_variable = {
            name = bpm_decree_actual_failure
            value = {
                value = var:bpm_decree_actual_success
                add = -2
                min = 2
            }
        }
        if = { 
            limit = {
                bpm_codification_decree_support > var:bpm_decree_actual_massive_success
            }
            #// do massive success stuff
            trigger_event = { id = bpm_codification_events.4 popup = yes days = { 7 60 } }
        }
        else_if = {
            limit = {
                bpm_codification_decree_support > var:bpm_decree_actual_success
            }
            #// do success stuff
            trigger_event = { id = bpm_codification_events.3 popup = yes days = { 7 60 } }
        }
        else_if = {
            limit = {
                bpm_codification_decree_support > var:bpm_decree_actual_failure
            }
            #// do failure stuff
            #//activate_law = var:bpm_decree_cooldown_current_law
            trigger_event = { id = bpm_codification_events.2 popup = yes days = { 7 60 } }
        }
        else = {
            #// do massive failure stuff
            #// activate_law = var:bpm_decree_cooldown_current_law
            trigger_event = { id = bpm_codification_events.5 popup = yes days = { 7 60 } }
        }
    }
}


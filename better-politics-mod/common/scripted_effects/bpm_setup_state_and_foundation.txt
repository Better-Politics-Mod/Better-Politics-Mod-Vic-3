bpm_setup_global_laws_varlists = {
    bpm_setup_foundations_varlist = yes
    bpm_setup_repeatables_varlist = yes
    #clear_variable_list = bpm_laws_foundation_category
    #clear_variable_list = bpm_laws_repeatable_category
}


bpm_setup_foundations_varlist = {
    # Foundations laws
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_monarchy
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_presidential_republic
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_parliamentary_republic
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_theocracy
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_council_republic
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_appointed_by_hos
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_appointed_on_advice
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_no_separate_hog
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_answers_to_legislature
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_advisory_body
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_separated_powers
    }
    add_to_global_variable_list = {
        name = bpm_laws_foundation_category
        target = law_type:law_supreme_legislature
    }
}

bpm_setup_repeatables_varlist = {
    # Repeatable laws
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_none
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_invite_foreign_experts
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_promote_democratic_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_promote_absolutist_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_promote_patriotic_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_promote_socialist_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_culture_promote_ultranationalist_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_none
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_liberalization
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_agricultural_investment
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_peasant_corvee
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_public_works
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_economy_forced_industrialization
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_none
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_military_reform
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_parades_and_drills
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_improve_soldier_conditions
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_army_defunding
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_military_war_propaganda
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_none
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_modernize_bureaucracy
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_military_purge
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_bureaucratic_purge
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_popular_concessions
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_anti_corruption_drive
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_politics_great_terror
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_religion_none
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_religion_anti_secular_reaction
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_religion_promote_state_religion
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_religion_promote_secular_values
	}
	add_to_global_variable_list = {
		name = bpm_laws_repeatable_category
		target = law_type:law_repeatable_religion_anti_religious_violence
	}
}

bpm_set_sta_ideology = {

    bpm_remove_all_sta_ideologies = yes
    add_ideology = ideology_sta_$ideology$_state
    bpm_reorder_ideologies = yes
}

bpm_update_sta_ideology = {
    every_interest_group = {
        if = {
            limit = {
                NOT = {
                    has_variable = bpm_do_not_touch_sta_ideology
                }
            }
            bpm_set_rest_sta_ideology = yes
            bpm_update_sta_ideology_extremists = yes
            bpm_update_sta_ideology_crisis = yes
        }
    }
}

bpm_update_sta_ideology_extremists = {
    if = {
        limit = {
            bpm_ig_is_radical_opposition = yes
        }
        bpm_set_sta_ideology = {
            ideology = weak
        }
    }
    if = {
        limit = {
            bpm_ig_is_very_radical_opposition = yes
        }
        bpm_set_sta_ideology = {
            ideology = minimal
        }
    }
}

bpm_update_sta_ideology_crisis = {
    if = {
        limit = {
            owner = { bpm_is_crisis_or_sticky = yes }
            law_stance = {
                law = owner.active_law:lawgroup_governance_principles.type
                value >= approve
            }
            NOR = {
                bpm_ig_is_radical_opposition = yes
                bpm_ig_is_very_radical_opposition = yes
            }
        }
        if = {
            limit = {
                bpm_ig_is_socialist = yes
            }
            bpm_set_sta_ideology = {
                ideology = subjugated_security
            }
        }
        else = {
            bpm_set_sta_ideology = {
                ideology = security
            }
        }
    }
}

bpm_set_rest_sta_ideology_subp = {
    if = {
        limit = {
            has_ideology = ideology:ideology_gov_$gov$
        }
        bpm_set_sta_ideology = {
            ideology = $sta$
        }
    }
}

bpm_set_rest_sta_ideology = {
    if = {
        limit = {
            OR = {
                is_interest_group_type = ig_petty_bourgeoisie
                is_interest_group_type = ig_armed_forces
                is_interest_group_type = ig_industrialists
            }
        }
        bpm_set_sta_ideology = {
            ideology = institutional
        }
    }
    if = {
        limit = {
            OR = {
                is_interest_group_type = ig_intelligentsia
            }
        }
        bpm_set_sta_ideology = {
            ideology = weak
        }
    }
    if = {
        limit = {
            OR = {
                is_interest_group_type = ig_rural_folk
            }
        }
        bpm_set_sta_ideology = {
            ideology = minimal
        }
    }
    if = {
        limit = {
            owner = {
                OR = {
                    has_law = law_type:law_monarchy
                    has_law = law_type:law_theocracy
                }
            }
        }
        if = {
            limit = {
                bpm_ig_is_upper_institutional = yes
            }
            bpm_set_rest_sta_ideology_subp = { gov = radical_monarchist sta = decentralized }
        }
        else = {
            bpm_set_rest_sta_ideology_subp = { gov = radical_monarchist sta = powerful }
        }
        bpm_set_rest_sta_ideology_subp = { gov = moderate_monarchist sta = devolved }
        bpm_set_rest_sta_ideology_subp = { gov = radical_proletarian sta = minimal }
        bpm_set_rest_sta_ideology_subp = { gov = moderate_proletarian sta = weak }
        bpm_set_rest_sta_ideology_subp = { gov = radical_republican sta = weak }
        bpm_set_rest_sta_ideology_subp = { gov = liberal_republican sta = devolved }
        if = {
            limit = {
                is_interest_group_type = ig_trade_unions
            }
            bpm_set_sta_ideology = {
                ideology = devolved
            }
        }
    }
    else_if = {
        limit = {
            owner = {
                OR = {
                    has_law = law_type:law_presidential_republic
                    has_law = law_type:law_parliamentary_republic
                }
            }
        }
        if = {
            limit = {
                owner = {
                    OR = {
                        has_law = law_type:law_federated
                        has_law = law_type:law_confederated
                    }
                }
            }
            bpm_set_rest_sta_ideology_subp = { gov = liberal_republican sta = federated }
        }
        else = {
            bpm_set_rest_sta_ideology_subp = { gov = liberal_republican sta = effective }
        }
        bpm_set_rest_sta_ideology_subp_lchk = { gov = radical_monarchist sta = minimal }
        bpm_set_rest_sta_ideology_subp = { gov = moderate_monarchist sta = weak }
        bpm_set_rest_sta_ideology_subp = { gov = radical_proletarian sta = minimal }
        bpm_set_rest_sta_ideology_subp = { gov = moderate_proletarian sta = weak }
        bpm_set_rest_sta_ideology_subp = { gov = radical_republican sta = progressive }
    }
    else_if = {
        limit = {
            owner = {
                OR = {
                    has_law = law_type:law_council_republic
                }
            }
        }
        bpm_set_rest_sta_ideology_subp = { gov = radical_monarchist sta = minimal}
        bpm_set_rest_sta_ideology_subp = { gov = moderate_monarchist sta = minimal }
        bpm_set_rest_sta_ideology_subp = { gov = radical_proletarian sta = subjugated }
        bpm_set_rest_sta_ideology_subp = { gov = moderate_proletarian sta = progressive }
        bpm_set_rest_sta_ideology_subp = { gov = radical_republican sta = minimal }
        bpm_set_rest_sta_ideology_subp = { gov = liberal_republican sta = minimal }
    }
}
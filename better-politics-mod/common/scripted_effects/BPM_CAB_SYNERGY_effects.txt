# -- Cabinet Register Institutions (6) (Synergy table bis) --
bpm_cab_update_synergy = {
    clear_variable_list = bpm_synergy_calculation_charset

    bpm_fill_charset_with_cabmins = yes

    bpm_calculate_synergy = yes

    bpm_disagreements_visualizing_helper = { tag = cabinet }

    set_variable = {
        name = bpm_cab_synergy
        value = var:bpm_temp_synergy_calculation
    }
    
    bpm_cab_update_antagonism = yes
    bpm_cab_update_hoshog_synergy = yes
}

bpm_cab_update_antagonism = {

    set_variable = {
        name = bpm_cached_antagonism
        value = bpm_antagonism
    }
    set_variable = {
        name = bpm_cached_antagonism_raw
        value = bpm_antagonism_raw
    }

}

bpm_disagreements_visualizing_helper_subp = {
    set_variable = {
        name = bpm_$tag$_disagreement_$category$
        value = {
            value = bpm_synergy_disagreement_$category$
            divide = bpm_synergy_v3_denominator
            multiply = 100
        }
        #value = 5
    }
    if = {
        limit = {
            var:bpm_$tag$_disagreement_$category$ > 0
        }
        add_to_variable_list = {
            name = bpm_$tag$_disagreements
            target = active_law:lawgroup_$lawgroup$
        }
    }
}

bpm_disagreements_visualizing_helper = {
    clear_variable_list = bpm_$tag$_disagreements
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = governance
        lawgroup = governance_principles
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = nationalism
        lawgroup = citizenship
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = economy
        lawgroup = economic_system
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = democracy
        lawgroup = distribution_of_power
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = religion
        lawgroup = church_and_state
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = security
        lawgroup = internal_security
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = unions
        lawgroup = labor_unions
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = workers
        lawgroup = labor_rights
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = isolation
        lawgroup = trade_policy
    }
    bpm_disagreements_visualizing_helper_subp = {
        tag = $tag$
        category = aristocracy
        lawgroup = bureaucracy
    }
}

bpm_cab_update_hoshog_synergy = {
    clear_variable_list = bpm_synergy_calculation_charset

    bpm_fill_charset_with_hoshog = yes

    bpm_calculate_synergy = yes

    bpm_disagreements_visualizing_helper = { tag = hoshog }


    set_variable = {
        name = bpm_cab_hoshog_synergy
        value = var:bpm_temp_synergy_calculation
    }

}

bpm_calculate_synergy = {
    set_variable = {
        name = bpm_temp_synergy_calculation
        value = bpm_synergy_v3
    }
}
    #

bpm_fill_charset_with_cabmins = {
    bpm_fill_charset_with_cabmins_subp = { INST = schools }
    bpm_fill_charset_with_cabmins_subp = { INST = police }
    bpm_fill_charset_with_cabmins_subp = { INST = health_system }
    bpm_fill_charset_with_cabmins_subp = { INST = home_affairs }
    bpm_fill_charset_with_cabmins_subp = { INST = centralization }
    bpm_fill_charset_with_cabmins_subp = { INST = suffrage }
    bpm_fill_charset_with_cabmins_subp = { INST = culture }
    bpm_fill_charset_with_cabmins_subp = { INST = colonial_affairs }
    bpm_fill_charset_with_cabmins_subp = { INST = social_security }
    bpm_fill_charset_with_cabmins_subp = { INST = workplace_safety }
    bpm_fill_charset_with_cabmins_subp = { INST = diplomacy }
    bpm_fill_charset_with_cabmins_subp = { INST = economy }
}

bpm_fill_charset_with_hoshog = {
    if = {
        limit = {
            has_variable = bpm_headofgov
            exists = var:bpm_headofgov
        }
        add_to_variable_list = {
            name = bpm_synergy_calculation_charset
            target = var:bpm_headofgov
        }
    }
    add_to_variable_list = {
        name = bpm_synergy_calculation_charset
        target = ruler
    }
}

bpm_fill_charset_with_cabmins_subp = {
    if = {
        limit = {
            has_variable = bpm_minister_of_$INST$
            exists = var:bpm_minister_of_$INST$
        }
        add_to_variable_list = {
            name = bpm_synergy_calculation_charset
            target = var:bpm_minister_of_$INST$
        }
    }
}